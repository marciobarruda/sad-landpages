<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Seleção Simplificada — HVR | Inscrição</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
      :root{
        --brand:#0d6efd;
        --brand-dark:#0b5ed7;
        --bg:#f9fbff;
        --text:#0b2447;
        --muted:#6c757d;
        --stage-w:1379px;
        --pattern-w:1366px;
      }
      body{
        background:
          radial-gradient(1200px 600px at -10% -10%, #f0f8ff 0%, #ffffff 60%),
          radial-gradient(800px 500px at 110% 0%, #f3f7ff 0%, #ffffff 60%),
          linear-gradient(180deg,#ffffff 0%, #f9fbff 100%);
        min-height:100vh;
        color:var(--text);
      }
      .stage{ width:var(--stage-w); margin:0 auto; position:relative; left:-6px; }
      header.hero{ width:var(--stage-w); height:240px; background:url('https://statics.recife.pe.gov.br/images/dynamics/zonaazul/banner.jpeg') center/cover no-repeat; }
      .pattern-strip{ width:var(--pattern-w); margin:0 auto; position:relative; left:-6px; background:url('https://statics.recife.pe.gov.br/images/dynamics/zonaazul/background.jpeg') repeat center/900px auto; }
      .pattern-top{ height:135px; opacity:.4; }
      .pattern-bottom{ height:135px; opacity:.4; }
      .frame-card{
        max-width:1020px;
        background:#ffffff;
        border-radius:1rem;
        box-shadow:0 18px 40px rgba(13,110,253,.12), 0 8px 22px rgba(13,110,253,.08);
        padding:2rem;
        position:relative;
        z-index:2;
        margin:-90px auto -90px !important;
      }
      .card-form{ border:0; border-radius:1rem; box-shadow:0 12px 34px rgba(13,110,253,.12), 0 6px 16px rgba(13,110,253,.08); overflow:hidden; }
      .card-form .card-header{ background:linear-gradient(180deg,#ffffff 0%, #f6f9ff 100%); border-bottom:1px solid #eef3ff; }
      .required::after{ content:" *"; color:#dc3545; font-weight:600; }
      .help{ font-size:.9rem; color:var(--muted); }
      .section-title{ font-weight:700; letter-spacing:.2px; color:#0b2447; }
      .dropzone{ border:2px dashed #cfe2ff; border-radius:.75rem; padding:1rem; background:#f8fbff; }
      .field-disabled{ opacity:.6; pointer-events:none; }
      .form-control:focus,.form-select:focus{ box-shadow:0 0 0 .25rem rgba(13,110,253,.15); border-color:var(--brand); }
      .form-control[readonly]{ background:#f8f9fa; }
      .badge-soft{ background:#e7f1ff; color:#0b2447; border:1px solid #cfe2ff; }
      .tiny{ font-size:.85rem; }
      pre.json{ background:#0b1020; color:#e6edf3; border-radius:.75rem; padding:1rem; max-height:40vh; overflow:auto; }
      .declaration-box{ background:#f8fbff; border:1px solid #d8e1fb; border-radius:.75rem; padding:1.1rem; font-size:.95rem; line-height:1.6; }
      .uploader-status{ font-size:.85rem; color:var(--muted); min-height:1.5rem; }
      .form-section{ margin-bottom:2.5rem; }
      .submit-row{ display:flex; gap:1rem; align-items:center; flex-wrap:wrap; }
      .submit-status{ font-size:.9rem; color:var(--muted); min-height:1.5rem; }
      @media (max-width: 992px){
        :root{ --stage-w:100vw; --pattern-w:100vw; }
        .stage, .pattern-strip{ left:0; }
        header.hero{ background-position:center; background-size:cover; }
        body{ overflow-x:hidden; }
        .frame-card{ margin:-60px auto -60px; padding:1.25rem; }
      }
    </style>
  </head>
  <body>
    <header class="hero stage"></header>
    <div class="pattern-strip pattern-top"></div>

    <main class="container my-4 frame-card" id="app">
      <div class="text-center mb-4">
        <h1 class="h4 mb-1">Seleção Simplificada — Hospital Veterinário do Recife</h1>
        <p class="text-muted subtle">Inscrição on-line</p>
      </div>

      <form id="inscricaoForm" class="form-sections">
      <section class="form-section">
        <div class="card card-form mb-4">
          <div class="card-header">
            <h2 class="h5 mb-0">Identificação civil</h2>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-3">
                <label class="form-label required" for="cpf">CPF</label>
                <input type="text" id="cpf" class="form-control" inputmode="numeric" maxlength="11" value="{{ String(($json.cpf ?? $json.preferred_username ?? '')).replace(/\D+/g, '').slice(0,11) }}" required>
                <div class="help tiny" id="cpfHelp"></div>
              </div>
              <div class="col-md-6">
                <label class="form-label required" for="nome">Nome completo</label>
                <input type="text" id="nome" class="form-control" value="{{ String($json.nome ?? $json.name ?? '').trim() || String($json.nome_social ?? $json.socialName ?? '').trim().toUpperCase() }}" required>
              </div>
              <div class="col-md-3">
                <label class="form-label required" for="nasc">Data de nascimento</label>
                <input type="date" id="nasc" class="form-control" value="{{ (($json.nasc ?? $json.dob) || '').split('/').reverse().join('-') }}" required>
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-4">
                <label class="form-label required" for="nacionalidade">Nacionalidade</label>
                <input type="text" id="nacionalidade" class="form-control" value="{{ String($json.nacionalidade ?? $json.nationality ?? '').trim().toUpperCase() }}" required>
              </div>
              <div class="col-md-5">
                <label class="form-label required" for="naturalidade_cidade">Naturalidade</label>
                <input type="text" id="naturalidade_cidade" class="form-control" value="{{ String($json.naturalidade ?? '').trim().toUpperCase() }}" required>
              </div>
              <div class="col-md-3">
                <label class="form-label required" for="naturalidade_uf">UF</label>
                <input type="text" id="naturalidade_uf" maxlength="2" class="form-control" value="{{ String($json.uf_naturalidade ?? '').trim().toUpperCase() }}" required>
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-3">
                <label class="form-label required" for="rg_numero">RG</label>
                <input type="text" id="rg_numero" class="form-control" inputmode="numeric" maxlength="14" value="{{ String($json.num_doc ?? '').replace(/\D+/g, '').slice(0,14) }}" required>
              </div>
              <div class="col-md-3">
                <label class="form-label required" for="rg_orgao">Órgão</label>
                <input type="text" id="rg_orgao" class="form-control" value="{{ String($json.orgao ?? '').trim().toUpperCase() }}" required>
              </div>
              <div class="col-md-3">
                <label class="form-label required" for="rg_uf">UF</label>
                <input type="text" id="rg_uf" maxlength="2" class="form-control" value="{{ String($json.uf_doc ?? '').trim().toUpperCase() }}" required>
              </div>
              <div class="col-md-3">
                <label class="form-label required" for="rg_data">Expedição</label>
                <input type="date" id="rg_data" class="form-control" value="{{ String($json.exp_doc ?? '').split('/').reverse().join('-') }}" required>
              </div>
            </div>
            <div class="row g-3 mt-0 align-items-end">
              <div class="col-md-4 col-lg-3">
                <label class="form-label required" for="sexo">Sexo</label>
                <select id="sexo" class="form-select" value="{{ String($json.sexo ?? $json.sex ?? $json.genero ?? $json.gender ?? '').trim() }}" data-prefill="{{ $json.sexo ?? $json.sex ?? $json.genero ?? $json.gender ?? '' }}" required>
                  <option value="">Selecione...</option>
                  <option>Feminino</option>
                  <option>Masculino</option>
                  <option>Prefiro não informar</option>
                </select>
              </div>
              <div class="col-md-4 col-lg-3">
                <label class="form-label required" for="genero">Gênero</label>
                <select id="genero" class="form-select" value="{{ String($json.genero ?? $json.genero_identidade ?? $json.genderIdentity ?? $json.gender ?? $json.sexo ?? '').trim() }}" data-prefill="{{ $json.genero ?? $json.genero_identidade ?? $json.genderIdentity ?? $json.gender ?? $json.sexo ?? '' }}" required>
                  <option value="">Selecione...</option>
                  <option>Mulher cisgênero</option>
                  <option>Mulher trans</option>
                  <option>Homem cisgênero</option>
                  <option>Homem trans</option>
                  <option>Pessoa não binária</option>
                  <option>Travesti</option>
                  <option>Outro</option>
                  <option>Prefiro não informar</option>
                </select>
              </div>
              <div class="col-md-4 col-lg-3 d-none" id="generoOutroCol">
                <label class="form-label" for="genero_outro">Informe o gênero</label>
                <input type="text" id="genero_outro" class="form-control" placeholder="Descreva o gênero" maxlength="80" value="{{ String($json.genero_outro ?? '').trim() }}">
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-4 col-lg-3">
                <label class="form-label required" for="estado_civil">Estado civil</label>
                <select id="estado_civil" class="form-select" data-prefill="{{ $json.estado_civil ?? $json.maritalStatus ?? '' }}" required>
                  <option value="">Selecione...</option>
                  <option>Solteiro(a)</option>
                  <option>Casado(a)</option>
                  <option>União estável</option>
                  <option>Divorciado(a)</option>
                  <option>Viúvo(a)</option>
                  <option>Separado(a)</option>
                </select>
              </div>
              <div class="col-md-4 col-lg-3">
                <label class="form-label" for="nis">NIS</label>
                <input type="text" id="nis" class="form-control" inputmode="numeric" maxlength="11" value="{{ String($json.nis ?? $json.pis ?? $json.pis_pasep ?? '').replace(/\D+/g, '').slice(0,11) }}">
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-4">
                <label class="form-label required" for="mae">Nome da mãe</label>
                <input type="text" id="mae" class="form-control" value="{{ String($json.mae ?? $json.motherName ?? '').trim().toUpperCase() }}" required>
              </div>
              <div class="col-md-4">
                <label class="form-label" for="pai">Nome do pai</label>
                <input type="text" id="pai" class="form-control" value="{{ String($json.pai ?? $json.fatherName ?? '').trim().toUpperCase() }}">
              </div>
              <div class="col-md-4">
                <label class="form-label" for="nome_social">Nome social</label>
                <input type="text" id="nome_social" class="form-control" value="{{ String($json.nome_social ?? $json.socialName ?? '').trim().toUpperCase() }}">
              </div>
            </div>
          </div>
        </div>

        <div class="card card-form mb-4">
          <div class="card-header">
            <h2 class="h5 mb-0">Situação militar e eleitoral</h2>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4 d-none" id="militarPergunta">
                <label class="form-label" id="militarPerguntaLabel">Obrigações militares em dia?</label><br>
                <div class="d-flex gap-3">
                  <div class="form-check"><input class="form-check-input" type="radio" name="militar" id="militar_sim" value="SIM"><label class="form-check-label" for="militar_sim">Sim</label></div>
                  <div class="form-check"><input class="form-check-input" type="radio" name="militar" id="militar_nao" value="NAO"><label class="form-check-label" for="militar_nao">Não</label></div>
                </div>
              </div>
              <div class="col-md-4">
                <label class="form-label required">Em pleno gozo dos direitos políticos?</label><br>
                <div class="d-flex gap-3">
                  <div class="form-check"><input class="form-check-input" type="radio" name="politicos" id="politicos_sim" value="SIM"><label class="form-check-label" for="politicos_sim">Sim</label></div>
                  <div class="form-check"><input class="form-check-input" type="radio" name="politicos" id="politicos_nao" value="NAO"><label class="form-check-label" for="politicos_nao">Não</label></div>
                </div>
              </div>
            </div>
            <div class="row g-3 mt-0 d-none" id="alistamentoWrap">
              <div class="col-md-4">
                <label class="form-label" for="alistamento_numero">Número do Certificado de Reservista</label>
                <input type="text" id="alistamento_numero" class="form-control">
              </div>
              <div class="col-md-4">
                <label class="form-label" for="alistamento_orgao">Órgão Emissor</label>
                <input type="text" id="alistamento_orgao" class="form-control">
              </div>
              <div class="col-md-4">
                <label class="form-label" for="alistamento_data">Data de emissão</label>
                <input type="date" id="alistamento_data" class="form-control">
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-4">
                <label class="form-label" for="titulo">Título de Eleitor</label>
                <input type="text" id="titulo" class="form-control" inputmode="numeric" maxlength="12">
              </div>
              <div class="col-md-4">
                <label class="form-label" for="zona">Zona</label>
                <input type="text" id="zona" class="form-control" inputmode="numeric" maxlength="4">
              </div>
              <div class="col-md-4">
                <label class="form-label" for="secao">Seção</label>
                <input type="text" id="secao" class="form-control" inputmode="numeric" maxlength="4">
              </div>
            </div>
          </div>
        </div>

      </section>

      <section class="form-section">
        <div class="card card-form mb-4">
          <div class="card-header">
            <h2 class="h5 mb-0">Contato</h2>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label required" for="email">E-mail</label>
                <input type="email" id="email" class="form-control" value="{{ String($json.email ?? '').trim().toLowerCase() }}" required>
                <div class="help tiny" id="emailHelp"></div>
              </div>
              <div class="col-md-6">
                <label class="form-label required" for="email_confirm">Confirme o e-mail</label>
                <input type="email" id="email_confirm" class="form-control" value="{{ String($json.email ?? '').trim().toLowerCase() }}" required>
                <div class="help tiny" id="emailConfirmHelp"></div>
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-6">
                <label class="form-label required" for="tel1">Telefone 1</label>
                <input type="text" id="tel1" class="form-control" inputmode="numeric" maxlength="11" placeholder="DDD + número" value="{{ String($json.telefone1 ?? $json.telefone ?? $json.phone ?? '').replace(/\D+/g, '') }}" required>
                <div class="help tiny" id="tel1Help"></div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="tel2">Telefone 2</label>
                <input type="text" id="tel2" class="form-control" inputmode="numeric" maxlength="11" placeholder="DDD + número" value="{{ String($json.telefone2 ?? $json.phone2 ?? '').replace(/\D+/g, '') }}">
                <div class="help tiny" id="tel2Help"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="card card-form mb-4">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h2 class="h5 mb-0">Endereço</h2>
            <span class="badge badge-soft">ViaCEP / BrasilAPI</span>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-3">
                <label class="form-label required" for="cep">CEP</label>
                <input type="text" id="cep" class="form-control" placeholder="00000-000" inputmode="numeric" maxlength="8" value="{{ String($json.postal_code ?? $json.cep ?? '').replace(/\D+/g, '') }}" required>
              </div>
              <div class="col-md-6">
                <label class="form-label required" for="logradouro">Logradouro</label>
                <input type="text" id="logradouro" class="form-control" value="{{ String($json.addressStreet ?? $json.logradouro ?? '').trim().toUpperCase() }}" required>
              </div>
              <div class="col-md-3">
                <label class="form-label required" for="numero">Número</label>
                <input type="text" id="numero" class="form-control" value="{{ String($json.numero ?? $json.addressNumber ?? '').trim().toUpperCase() }}" required>
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-4">
                <label class="form-label" for="complemento">Complemento</label>
                <input type="text" id="complemento" class="form-control" value="{{ String($json.complemento ?? $json.addressComplement ?? '').trim().toUpperCase() }}">
              </div>
              <div class="col-md-4">
                <label class="form-label required" for="bairro">Bairro</label>
                <input type="text" id="bairro" class="form-control" value="{{ String($json.neighborhood ?? $json.bairro ?? '').trim().toUpperCase() }}" required>
              </div>
              <div class="col-md-4">
                <label class="form-label required" for="cidade">Cidade</label>
                <input type="text" id="cidade" class="form-control" value="{{ String($json.cidade ?? $json.locality ?? $json.city ?? '').trim().toUpperCase() }}" required>
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-3">
                <label class="form-label required" for="uf">UF</label>
                <input type="text" id="uf" class="form-control" maxlength="2" value="{{ String(($json.state ?? $json.addressState ?? $json.uf ?? '')).trim().toUpperCase() }}" required>
              </div>
            </div>
          </div>
        </div>


      </section>

      <section class="form-section">
        <div class="card card-form mb-4">
          <div class="card-header">
            <h2 class="h5 mb-0">Escolaridade e formação</h2>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label required" for="nivel">Nível</label>
                <select id="nivel" class="form-select" data-prefill="{{ $json.nivel ?? $json.nivel_escolaridade ?? $json.escolaridade ?? '' }}" required>
                  <option value="">Selecione...</option>
                  <option>Fundamental</option>
                  <option>Médio</option>
                  <option>Técnico</option>
                  <option>Graduação</option>
                  <option>Pós-graduação</option>
                  <option>Mestrado</option>
                  <option>Doutorado</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label required" for="ies">Instituição</label>
                <input type="text" id="ies" class="form-control" value="{{ String($json.instituicao ?? $json.ies ?? '').trim().toUpperCase() }}" required>
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-9">
                <label class="form-label required" for="curso">Curso</label>
                <input type="text" id="curso" class="form-control" value="{{ String($json.curso ?? '').trim().toUpperCase() }}" required>
              </div>
              <div class="col-md-3">
                <label class="form-label required" for="ano_conclusao">Ano de conclusão</label>
                <input type="text" id="ano_conclusao" class="form-control" inputmode="numeric" maxlength="4" value="{{ String($json.ano ?? $json.ano_conclusao ?? '').replace(/\D+/g, '').slice(0,4) }}" required>
              </div>
            </div>
          </div>
        </div>


      </section>

      <section class="form-section">
        <div class="card card-form mb-4">
          <div class="card-header">
            <h2 class="h5 mb-0">Dados do certame</h2>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label required" for="cargo">Cargo pretendido</label>
                <select id="cargo" class="form-select" data-prefill="{{ $json.cargo ?? $json.cargo_pretendido ?? '' }}" required>
                  <option value="">Selecione...</option>
                  <option value="Analista em Saúde Animal – Veterinário 40h">Analista em Saúde Animal – Veterinário 40h</option>
                  <option value="Analista em Saúde Animal – Veterinário 20h">Analista em Saúde Animal – Veterinário 20h</option>
                  <option value="Analista em Saúde Animal – Veterinário 40h Plantonista">Analista em Saúde Animal – Veterinário 40h Plantonista</option>
                  <option value="Auxiliar em Saúde Animal - Auxiliar Veterinário 40h">Auxiliar em Saúde Animal - Auxiliar Veterinário 40h</option>
                  <option value="Auxiliar em Saúde Animal - Auxiliar Veterinário 40h Plantonista">Auxiliar em Saúde Animal - Auxiliar Veterinário 40h Plantonista</option>
                  <option value="Técnico em Saúde Animal - Radiologia e Imagenologia 24h">Técnico em Saúde Animal - Radiologia e Imagenologia 24h</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="especialidade">Especialidade (quando houver)</label>
                <input type="text" id="especialidade" class="form-control" value="{{ String($json.especialidade ?? '').trim().toUpperCase() }}">
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-6">
                <label class="form-label required d-block">Exerceu efetivamente a função de jurado(a), nos termos do art. 440 do Código de Processo Penal, no período previsto pelo edital?</label>
                <div class="d-flex gap-3">
                  <div class="form-check"><input class="form-check-input" type="radio" name="jurado_funcao" id="jurado_sim" value="SIM" required><label class="form-check-label" for="jurado_sim">Sim</label></div>
                  <div class="form-check"><input class="form-check-input" type="radio" name="jurado_funcao" id="jurado_nao" value="NAO"><label class="form-check-label" for="jurado_nao">Não</label></div>
                </div>
                <input type="hidden" id="foi_jurado" value="{{ String($json.foi_jurado ?? $json.jurado ?? '').trim().toUpperCase() }}">
              </div>
              <div class="col-md-6 d-none" id="juradoPeriodoWrap">
                <label class="form-label" for="jurado_periodo">Informações sobre a atuação como jurado(a)</label>
                <input type="text" id="jurado_periodo" class="form-control" placeholder="Tribunal, período ou outros detalhes" value="{{ String($json.jurado_periodo ?? '').trim() }}">
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-6">
                <label class="form-label required d-block">Possui vínculo anterior ou atual com o Serviço Público (Federal, Estadual ou Municipal)?</label>
                <div class="d-flex gap-3">
                  <div class="form-check"><input class="form-check-input" type="radio" name="vinculo_publico_opcao" id="vinculo_publico_sim" value="Sim" required><label class="form-check-label" for="vinculo_publico_sim">Sim</label></div>
                  <div class="form-check"><input class="form-check-input" type="radio" name="vinculo_publico_opcao" id="vinculo_publico_nao" value="Não"><label class="form-check-label" for="vinculo_publico_nao">Não</label></div>
                </div>
                <input type="hidden" id="vinculo_publico" value="{{ String($json.vinculo_publico ?? '').trim() }}">
              </div>
              <div class="col-md-3 d-none" id="qualVinculoWrap">
                <label class="form-label" for="qual_vinculo">Qual vínculo</label>
                <input type="text" id="qual_vinculo" class="form-control" value="{{ String($json.qual_vinculo ?? '').trim() }}">
              </div>
              <div class="col-md-3 d-none" id="experienciaTempoWrap">
                <label class="form-label" for="experiencia_tempo">Tempo (meses/anos)</label>
                <input type="text" id="experiencia_tempo" class="form-control" value="{{ String($json.experiencia_tempo ?? '').trim() }}">
              </div>
            </div>
          </div>
        </div>


      </section>

      <section class="form-section">
        <div class="card card-form mb-4">
          <div class="card-header">
            <h2 class="h5 mb-0">Informações de raça e cotas</h2>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label required" for="raca">Cor/Raça (IBGE)</label>
                <select id="raca" class="form-select" data-prefill="{{ $json.raca ?? $json.race ?? '' }}" required>
                  <option value="">Selecione...</option>
                  <option>Branca</option>
                  <option>Preta</option>
                  <option>Parda</option>
                  <option>Amarela</option>
                  <option>Indígena</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label required" for="cotasPPNI">Concorrer às vagas PPNI?</label>
                <select id="cotasPPNI" class="form-select" data-prefill="{{ $json.cotasPPNI ?? $json.concorrer_ppni ?? '' }}" required>
                  <option value="">Selecione...</option>
                  <option>Sim</option>
                  <option>Não</option>
                </select>
              </div>
            </div>
            <div class="help tiny mt-2">Se optar por PPNI, serão exigidos arquivos de heteroidentificação abaixo.</div>
          </div>
        </div>

        <div class="card card-form mb-4">
          <div class="card-header">
            <h2 class="h5 mb-0">Pessoa com Deficiência (PCD)</h2>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-3">
                <label class="form-label required" for="is_pcd">É PCD?</label>
                <select id="is_pcd" class="form-select" data-prefill="{{ $json.is_pcd ?? $json.withDisability ?? '' }}" required>
                  <option value="">Selecione...</option>
                  <option>Sim</option>
                  <option>Não</option>
                </select>
              </div>
              <div id="pcdDetalhes" class="col-md-9 d-none">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label" for="tipo_pcd">Tipo de deficiência</label>
                    <input type="text" id="tipo_pcd" class="form-control" value="{{ String($json.tipo_pcd ?? '').trim() }}">
                  </div>
                  <div class="col-md-6">
                    <label class="form-label" for="pcd_cid">CID (se houver)</label>
                    <input type="text" id="pcd_cid" class="form-control" value="{{ String($json.pcd_cid ?? '').trim().toUpperCase() }}">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card card-form mb-4">
          <div class="card-header">
            <h2 class="h5 mb-0">Condições especiais para as etapas</h2>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label required d-block">Necessita de condições especiais para a realização das etapas da seleção?</label>
                <div class="d-flex gap-3">
                  <div class="form-check"><input class="form-check-input" type="radio" name="condicao_especial" id="condicao_especial_sim" value="Sim" required><label class="form-check-label" for="condicao_especial_sim">Sim</label></div>
                  <div class="form-check"><input class="form-check-input" type="radio" name="condicao_especial" id="condicao_especial_nao" value="Não"><label class="form-check-label" for="condicao_especial_nao">Não</label></div>
                </div>
              </div>
              <div class="col-md-8">
                <label class="form-label" for="necessidade">Descreva a necessidade</label>
                <textarea id="necessidade" class="form-control" rows="2" placeholder="Informe recursos ou adaptações necessários">{{ String($json.necessidade ?? $json.specialNeedDescription ?? '').trim() }}</textarea>
              </div>
            </div>
          </div>
        </div>


      </section>



      <section class="form-section">
        <div class="card card-form mb-4">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h2 class="h5 mb-0">Documentos</h2>
            <span class="badge badge-soft">2 MB por doc/foto • 30 MB vídeo</span>
          </div>
          <div class="card-body">
            <ul class="tiny mb-3">
              <li>Documentos/fotos: PDF, JPG, JPEG, PNG (até 2 MB cada).</li>
              <li>Vídeo (heteroidentificação): MP4, MOV (até 30 MB).</li>
            </ul>

            <section class="mb-4">
              <h3 class="h6 section-title mb-2">1) Cadastro</h3>
              <div class="row g-3 align-items-end">
                <div class="col-md-8">
                  <label class="form-label required">Documento de identificação oficial com foto (frente)</label>
                  <div class="dropzone"><input class="form-control" type="file" id="doc_id_frente" accept=".pdf,image/*" required></div>
                </div>
                <div class="col-md-4"><div id="status_doc_id_frente" class="uploader-status ms-auto"></div></div>

                <div class="col-md-8">
                  <label class="form-label required">Documento de identificação oficial com foto (verso)</label>
                  <div class="dropzone"><input class="form-control" type="file" id="doc_id_verso" accept=".pdf,image/*" required></div>
                </div>
                <div class="col-md-4"><div id="status_doc_id_verso" class="uploader-status ms-auto"></div></div>

                <div class="col-md-8">
                  <label class="form-label required">CPF</label>
                  <div class="dropzone"><input class="form-control" type="file" id="doc_cpf" accept=".pdf,image/*" required></div>
                </div>
                <div class="col-md-4"><div id="status_doc_cpf" class="uploader-status ms-auto"></div></div>

                <div class="col-md-8">
                  <label class="form-label required">Comprovante de residência</label>
                  <div class="dropzone"><input class="form-control" type="file" id="doc_residencia" accept=".pdf,image/*" required></div>
                </div>
                <div class="col-md-4"><div id="status_doc_res" class="uploader-status ms-auto"></div></div>

                <div class="col-md-8">
                  <label class="form-label required">Quitação eleitoral</label>
                  <div class="dropzone"><input class="form-control" type="file" id="doc_quitacao_eleitoral" accept=".pdf,image/*" required></div>
                </div>
                <div class="col-md-4"><div id="status_doc_eleitoral" class="uploader-status ms-auto"></div></div>

                <div class="col-md-8" id="docMilitarWrap">
                  <label class="form-label" id="docMilitarLabel">Quitação do serviço militar</label>
                  <div class="dropzone"><input class="form-control" type="file" id="doc_militar" accept=".pdf,image/*"></div>
                  <div class="help tiny">Obrigatório para candidatos do gênero masculino. Exemplos: CAM, CDI, CI ou CRM.</div>
                </div>
                <div class="col-md-4" id="status_doc_militar_wrap"><div id="status_doc_militar" class="uploader-status ms-auto"></div></div>

                <div class="col-md-8 d-none" id="doc_jurado_wrap">
                  <label class="form-label" id="docJuradoLabel">Certidão de atuação na função de jurado</label>
                  <div class="dropzone"><input class="form-control" type="file" id="doc_jurado" accept=".pdf,image/*"></div>
                  <div class="help tiny">Anexe quando declarar atuação como jurado(a) conforme o edital.</div>
                </div>
                <div class="col-md-4 d-none" id="status_doc_jurado_wrap"><div id="status_doc_jurado" class="uploader-status ms-auto"></div></div>

                <div class="col-md-8 d-none" id="doc_jurado_440_wrap">
                  <label class="form-label">Certidão de atuação na função de jurado (art. 440 do CPP)</label>
                  <div class="dropzone"><input class="form-control" type="file" id="doc_jurado_440" accept=".pdf,image/*"></div>
                  <div class="help tiny">Anexar quando houver atuação no período previsto em lei.</div>
                </div>
                <div class="col-md-4 d-none" id="status_doc_jurado_440_wrap"><div id="status_doc_jurado_440" class="uploader-status ms-auto"></div></div>

                <div class="col-md-8">
                  <label class="form-label required">Comprovação da escolaridade</label>
                  <div class="dropzone"><input class="form-control" type="file" id="doc_escolaridade" accept=".pdf,image/*" required></div>
                </div>
                <div class="col-md-4"><div id="status_doc_escolaridade" class="uploader-status ms-auto"></div></div>

                <div class="col-md-8">
                  <label class="form-label">Experiência / títulos / certificados</label>
                  <div class="dropzone"><input class="form-control" type="file" id="doc_curriculo" accept=".pdf,image/*" multiple></div>
                </div>
                <div class="col-md-4"><div id="status_doc_curriculo" class="uploader-status ms-auto"></div></div>
              </div>
            </section>

      

      

            <hr>

            <section class="mb-4 d-none field-disabled" id="hetSection">
              <h3 class="h6 section-title mb-2">2) Heteroidentificação (se PPNI)</h3>
              <div class="row g-3">
                <div class="col-md-8">
                  <label class="form-label">Declaração de heteroidentificação</label>
                  <div class="dropzone"><input class="form-control" type="file" id="het_declaracao" accept=".pdf,image/*"></div>
                </div>
                <div class="col-md-4 d-flex align-items-end"><div id="status_het_declaracao" class="uploader-status ms-auto"></div></div>

                <div class="col-md-8">
                  <label class="form-label">Documento de identidade (frente/verso)</label>
                  <div class="dropzone"><input class="form-control" type="file" id="het_id" accept=".pdf,image/*" multiple></div>
                </div>
                <div class="col-md-4 d-flex align-items-end"><div id="status_het_id" class="uploader-status ms-auto"></div></div>

                <div class="col-md-6">
                  <label class="form-label">Foto de frente</label>
                  <div class="dropzone"><input class="form-control" type="file" id="het_frente" accept="image/*"></div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Foto de perfil</label>
                  <div class="dropzone"><input class="form-control" type="file" id="het_perfil" accept="image/*"></div>
                </div>

                <div class="col-md-12">
                  <label class="form-label">Vídeo (até 20s)</label>
                  <div class="dropzone"><input class="form-control" type="file" id="het_video" accept="video/mp4,video/quicktime"></div>
                  <div class="help tiny">Diga: “declaro que sou negro, da cor preta ou parda”.</div>
                  <div id="status_het_video" class="uploader-status mt-2"></div>
                </div>
              </div>
            </section>

            <hr>

            <section id="pcdDocsSection" class="mb-2 d-none field-disabled">
              <h3 class="h6 section-title mb-2">3) Avaliação biopsicossocial (PCD)</h3>
              <div class="row g-3">
                <div class="col-md-8">
                  <label class="form-label">Laudo médico</label>
                  <div class="dropzone"><input class="form-control" type="file" id="pcd_laudo" accept=".pdf,.png,.jpeg,.jpg,.gif"></div>
                </div>
                <div class="col-md-4 d-flex align-items-end"><div id="status_pcd_laudo" class="uploader-status ms-auto"></div></div>
                <div class="col-md-8">
                  <label class="form-label">Declaração de deficiência (modelo do edital)</label>
                  <div class="dropzone"><input class="form-control" type="file" id="pcd_declaracao" accept=".pdf,image/*"></div>
                </div>
                <div class="col-md-4 d-flex align-items-end"><div id="status_pcd_declaracao" class="uploader-status ms-auto"></div></div>
                <div class="col-md-8">
                  <label class="form-label">Exames complementares (opcional)</label>
                  <div class="dropzone"><input class="form-control" type="file" id="pcd_exames" accept=".pdf,image/*" multiple></div>
                </div>
                <div class="col-md-4 d-flex align-items-end"><div id="status_pcd_exames" class="uploader-status ms-auto"></div></div>
              </div>
            </section>
          </div>
        </div>


      </section>


      <section class="form-section">
        <div class="card card-form mb-5">
          <div class="card-header">
            <h2 class="h5 mb-0">Revisão e envio</h2>
          </div>
          <div class="card-body">
            <p class="text-muted tiny mb-4">Revise seus dados, confirme as declarações e envie a inscrição para análise da equipe do Hospital Veterinário do Recife.</p>
            <div class="mb-4">
              <h3 class="h6 section-title mb-2">Declaração de responsabilidade</h3>
              <div class="declaration-box mb-3" id="responsibilityText">
                <p>Declaro, sob as penas da Lei, que concordo com os termos que constam do Edital n° XXXX/2025 de Abertura de Inscrições bem como declaro que aceito que os meus dados pessoais, sensíveis ou não, sejam tratados e processados, de forma a possibilitar a efetiva execução da seleção simplificada, com a aplicação dos critérios de avaliação e seleção, autorizando expressamente a divulgação dos meus nomes, números de inscrição, critérios de desempate e das minhas notas, em observância aos princípios da publicidade e da transparência que regem a Administração Pública e nos termos da Lei federal n° 13.709, de 14 de agosto de 2018.</p>
                <p>Declaro, sob as penas da Lei, que os dados informados neste formulário são verdadeiros e que conheço e aceito todas as regras pertinentes ao concurso consignadas no Edital n° xx/2025 de Abertura de Inscrições.</p>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="termoResponsabilidade" required>
                <label class="form-check-label" for="termoResponsabilidade">Li e estou de acordo com a declaração de responsabilidade.</label>
              </div>
            </div>
            <div class="submit-row">
              <button type="submit" class="btn btn-primary" id="btnSubmit">Enviar inscrição</button>
              <div id="submitStatus" class="submit-status"></div>
            </div>
            <pre class="json mt-3 d-none" id="submitOut"></pre>
          </div>
        </div>
      </section>

      <div id="recursoWrapper" class="card card-form mb-5 d-none" aria-hidden="true">
        <div class="card-header">
          <h2 class="h5 mb-0">Interposição de recursos</h2>
        </div>
        <div class="card-body">
          <div class="alert alert-info tiny" role="status" id="recursoInfo">Área disponível apenas durante o período de recursos divulgado no cronograma.</div>
          <div class="row g-3 mt-0">
            <div class="col-md-6">
              <label class="form-label" for="recurso_tipo">Tipo de recurso</label>
              <select id="recurso_tipo" class="form-select">
                <option value="">Selecione...</option>
                <option value="analise_curricular">Resultado Preliminar da Análise Curricular</option>
                <option value="heteroidentificacao">Resultado Preliminar do Procedimento de Heteroidentificação</option>
                <option value="biopsicossocial">Resultado Preliminar da Avaliação Biopsicossocial</option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label" for="recurso_texto">Justificativa</label>
              <textarea id="recurso_texto" class="form-control" rows="4" placeholder="Descreva o motivo do recurso"></textarea>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="recurso_anexo">Anexo (opcional)</label>
              <div class="dropzone"><input class="form-control" type="file" id="recurso_anexo" accept=".pdf,image/*"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="text-center text-muted tiny mb-5">Pré-validações locais. A conferência oficial seguirá o Edital do certame.</div>
      </form>
    </main>

    <div class="pattern-strip pattern-bottom"></div>

    <script>
      const FINAL_ENDPOINT = "https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/instanciar-se-hospvet";

      const $ = (sel) => document.querySelector(sel);
      const onlyDigits = (value) => String(value ?? '').replace(/\D+/g, '');
      const normalizeEmail = (value) => String(value ?? '').trim().toLowerCase();

      const form = document.getElementById('inscricaoForm');
      const statusEl = document.getElementById('submitStatus');
      const outputEl = document.getElementById('submitOut');
      const responsibilityCheckbox = document.getElementById('termoResponsabilidade');
      const recursoWrapper = document.getElementById('recursoWrapper');

      const recursoState = { enabled: false, start: null, end: null };

      function applyPrefill(){
        document.querySelectorAll('[data-prefill]').forEach((el) => {
          const value = el.getAttribute('data-prefill');
          if(value === null || value === undefined || value === '') return;
          if(el.tagName === 'SELECT'){
            el.value = value;
          }else{
            el.value = value;
          }
        });
      }

      function syncRadioWithHidden(name, hiddenId){
        const hidden = document.getElementById(hiddenId);
        const radios = Array.from(document.querySelectorAll(`input[name="${name}"]`));
        if(!hidden || !radios.length) return;
        const match = radios.find((radio) => radio.value === hidden.value);
        if(match) match.checked = true;
        radios.forEach((radio) => {
          radio.addEventListener('change', () => {
            if(radio.checked){
              hidden.value = radio.value;
              if(hiddenId === 'foi_jurado'){
                toggleJuradoDetails();
              }
              if(hiddenId === 'vinculo_publico'){
                toggleVinculoDetails();
              }
            }
          });
        });
      }

      function toggleGeneroOutro(){
        const genero = $('#genero');
        const outroCol = $('#generoOutroCol');
        const outroInput = $('#genero_outro');
        const isOutro = genero && genero.value === 'Outro';
        outroCol?.classList.toggle('d-none', !isOutro);
        if(outroInput){
          outroInput.required = Boolean(isOutro);
          if(!isOutro){
            outroInput.value = '';
          }
        }
      }

      function toggleGeneroDependents(){
        const sexo = ($('#sexo')?.value || '').toLowerCase();
        const isMasc = sexo === 'masculino';
        const militarWrap = $('#militarPergunta');
        militarWrap?.classList.toggle('d-none', !isMasc);
        document.querySelectorAll('input[name="militar"]').forEach((radio) => {
          radio.required = isMasc;
          radio.disabled = !isMasc;
          if(!isMasc) radio.checked = false;
        });
        const docWrap = $('#docMilitarWrap');
        docWrap?.classList.toggle('d-none', !isMasc);
        docWrap?.classList.toggle('field-disabled', !isMasc);
        const docInput = $('#doc_militar');
        if(docInput){
          docInput.required = isMasc;
          docInput.disabled = !isMasc;
          if(!isMasc) docInput.value = '';
        }
        const statusWrap = $('#status_doc_militar_wrap');
        statusWrap?.classList.toggle('d-none', !isMasc);
        statusWrap?.classList.toggle('field-disabled', !isMasc);
        const docLabel = $('#docMilitarLabel');
        docLabel?.classList.toggle('required', isMasc);
        const militarLabel = $('#militarPerguntaLabel');
        militarLabel?.classList.toggle('required', isMasc);
        const alistamentoWrap = $('#alistamentoWrap');
        alistamentoWrap?.classList.toggle('d-none', !isMasc);
        alistamentoWrap?.classList.toggle('field-disabled', !isMasc);
        ['alistamento_numero','alistamento_orgao','alistamento_data'].forEach((id) => {
          const field = document.getElementById(id);
          if(!field) return;
          field.required = isMasc;
          field.disabled = !isMasc;
          if(!isMasc) field.value = '';
        });
      }

      function toggleJuradoDetails(){
        const hidden = document.getElementById('foi_jurado');
        const value = String(hidden?.value || '').toUpperCase();
        const show = value === 'SIM';
        const periodoWrap = $('#juradoPeriodoWrap');
        const periodo = $('#jurado_periodo');
        periodoWrap?.classList.toggle('d-none', !show);
        if(periodo){
          periodo.required = show;
          if(!show) periodo.value = '';
        }
        const juradoWrap = $('#doc_jurado_wrap');
        const juradoInput = $('#doc_jurado');
        const juradoStatus = $('#status_doc_jurado_wrap');
        [juradoWrap, juradoStatus].forEach((wrap) => {
          wrap?.classList.toggle('d-none', !show);
          wrap?.classList.toggle('field-disabled', !show);
        });
        if(juradoInput){
          juradoInput.disabled = !show;
          juradoInput.required = show;
          if(!show) juradoInput.value = '';
        }
        const jurado440Wrap = $('#doc_jurado_440_wrap');
        const jurado440Input = $('#doc_jurado_440');
        const jurado440Status = $('#status_doc_jurado_440_wrap');
        [jurado440Wrap, jurado440Status].forEach((wrap) => {
          wrap?.classList.toggle('d-none', !show);
          wrap?.classList.toggle('field-disabled', !show);
        });
        if(jurado440Input){
          jurado440Input.disabled = !show;
          if(!show) jurado440Input.value = '';
        }
      }

      function toggleVinculoDetails(){
        const hidden = document.getElementById('vinculo_publico');
        const show = String(hidden?.value || '').toUpperCase() === 'SIM';
        ['qualVinculoWrap','experienciaTempoWrap'].forEach((id) => {
          const wrap = document.getElementById(id);
          wrap?.classList.toggle('d-none', !show);
        });
        ['qual_vinculo','experiencia_tempo'].forEach((id) => {
          const field = document.getElementById(id);
          if(!field) return;
          field.required = show;
          if(!show) field.value = '';
        });
      }

      function updateNecessidadeRequirement(){
        const needField = $('#necessidade');
        if(!needField) return;
        const condicao = document.querySelector('input[name="condicao_especial"]:checked');
        const isPcd = String($('#is_pcd')?.value || '').toUpperCase() === 'SIM';
        const required = (condicao?.value === 'Sim') || isPcd;
        needField.required = required;
        if(!required && condicao?.value !== 'Sim' && !isPcd){
          needField.value = '';
        }
      }

      function togglePcdDetails(){
        const isSim = String($('#is_pcd')?.value || '').toUpperCase() === 'SIM';
        const detalhes = $('#pcdDetalhes');
        const docs = $('#pcdDocsSection');
        detalhes?.classList.toggle('d-none', !isSim);
        docs?.classList.toggle('d-none', !isSim);
        docs?.classList.toggle('field-disabled', !isSim);
        const tipo = $('#tipo_pcd');
        if(tipo){
          tipo.required = isSim;
          tipo.disabled = !isSim;
          if(!isSim) tipo.value = '';
        }
        const cid = $('#pcd_cid');
        if(cid){
          cid.disabled = !isSim;
          if(!isSim) cid.value = '';
        }
        if(!isSim){
          ['pcd_laudo','pcd_declaracao','pcd_exames'].forEach((id) => {
            const field = document.getElementById(id);
            if(field) field.value = '';
          });
        }
        const laudo = $('#pcd_laudo');
        const declaracao = $('#pcd_declaracao');
        if(laudo){
          laudo.disabled = !isSim;
          laudo.required = isSim;
        }
        if(declaracao){
          declaracao.disabled = !isSim;
          declaracao.required = isSim;
        }
        const exames = $('#pcd_exames');
        if(exames){
          exames.disabled = !isSim;
        }
        updateNecessidadeRequirement();
      }

      function toggleHeteroDocs(){
        const isPPNI = String($('#cotasPPNI')?.value || '').toUpperCase() === 'SIM';
        const section = $('#hetSection');
        section?.classList.toggle('d-none', !isPPNI);
        section?.classList.toggle('field-disabled', !isPPNI);
        [
          { id: 'het_declaracao', required: isPPNI },
          { id: 'het_id', required: false },
          { id: 'het_frente', required: false },
          { id: 'het_perfil', required: false },
          { id: 'het_video', required: isPPNI }
        ].forEach(({ id, required }) => {
          const input = document.getElementById(id);
          if(!input) return;
          input.disabled = !isPPNI;
          input.required = required;
          if(!isPPNI) input.value = '';
        });
      }

      function updateEmailFeedback(){
        const emailInput = $('#email');
        const confirmInput = $('#email_confirm');
        const helpPrimary = $('#emailHelp');
        const helpConfirm = $('#emailConfirmHelp');
        if(!emailInput || !confirmInput) return;
        const email = normalizeEmail(emailInput.value);
        const confirm = normalizeEmail(confirmInput.value);
        const emailValid = email ? /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email) : false;
        emailInput.setCustomValidity(email && !emailValid ? 'E-mail inválido' : '');
        if(helpPrimary){
          helpPrimary.textContent = email && !emailValid ? 'Informe um e-mail válido.' : '';
        }
        let confirmMessage = '';
        if(confirm){
          if(!emailValid){
            confirmMessage = 'Informe primeiro um e-mail válido.';
            confirmInput.setCustomValidity(confirmMessage);
          }else if(email !== confirm){
            confirmMessage = 'Os e-mails informados não conferem.';
            confirmInput.setCustomValidity(confirmMessage);
          }else{
            confirmInput.setCustomValidity('');
          }
        }else{
          confirmInput.setCustomValidity('');
        }
        if(helpConfirm){
          helpConfirm.textContent = confirmMessage;
        }
      }

      function parseDate(value){
        if(!value) return null;
        const date = new Date(value);
        return Number.isNaN(date.getTime()) ? null : date;
      }

      function updateResourceAreaVisibility(){
        if(!recursoWrapper) return;
        let show = false;
        if(recursoState.enabled){
          if(recursoState.start && recursoState.end){
            const now = new Date();
            show = now >= recursoState.start && now <= recursoState.end;
          }else{
            show = true;
          }
        }
        recursoWrapper.classList.toggle('d-none', !show);
        recursoWrapper.setAttribute('aria-hidden', show ? 'false' : 'true');
      }

      window.configureResourceWindow = function(config = {}){
        recursoState.enabled = Boolean(config.enabled);
        recursoState.start = parseDate(config.start);
        recursoState.end = parseDate(config.end);
        updateResourceAreaVisibility();
      };

      window.toggleResourceArea = function(flag){
        recursoState.enabled = Boolean(flag);
        updateResourceAreaVisibility();
      };

      async function lookupCep(raw){
        const normalized = onlyDigits(raw);
        if(normalized.length !== 8) return null;
        const providers = [
          async () => {
            const res = await fetch(`https://viacep.com.br/ws/${normalized}/json/`);
            if(!res.ok) return null;
            const data = await res.json();
            if(data?.erro) return null;
            return { logradouro: data.logradouro, bairro: data.bairro, cidade: data.localidade, uf: data.uf };
          },
          async () => {
            const res = await fetch(`https://brasilapi.com.br/api/cep/v1/${normalized}`);
            if(!res.ok) return null;
            const data = await res.json();
            if(data?.errors || data?.error || data?.message) return null;
            return { logradouro: data.street || data.logradouro, bairro: data.neighborhood || data.bairro, cidade: data.city || data.localidade, uf: data.state || data.uf };
          }
        ];
        for(const provider of providers){
          try{
            const result = await provider();
            if(result) return result;
          }catch(e){}
        }
        return null;
      }

      async function autofillAddressByCep(){
        const cepInput = $('#cep');
        if(!cepInput) return;
        const data = await lookupCep(cepInput.value);
        if(!data) return;
        if(data.logradouro) $('#logradouro').value = String(data.logradouro).toUpperCase();
        if(data.bairro) $('#bairro').value = String(data.bairro).toUpperCase();
        if(data.cidade) $('#cidade').value = String(data.cidade).toUpperCase();
        if(data.uf) $('#uf').value = String(data.uf).toUpperCase();
      }

      function buildPayload(){
        const cargoSelect = $('#cargo');
        const cargoValue = cargoSelect?.value || '';
        const cargoLabel = cargoSelect && cargoSelect.selectedOptions?.length ? cargoSelect.selectedOptions[0].textContent.trim() : '';
        return {
          nome: $('#nome')?.value.trim() || '',
          nome_social: $('#nome_social')?.value.trim() || '',
          data_nascimento: $('#nasc')?.value || '',
          sexo: $('#sexo')?.value || '',
          genero: $('#genero')?.value || '',
          genero_outro: $('#genero')?.value === 'Outro' ? ($('#genero_outro')?.value.trim() || '') : '',
          estado_civil: $('#estado_civil')?.value || '',
          nome_mae: $('#mae')?.value.trim() || '',
          nome_pai: $('#pai')?.value.trim() || '',
          nacionalidade: $('#nacionalidade')?.value.trim() || '',
          naturalidade_cidade: $('#naturalidade_cidade')?.value.trim() || '',
          naturalidade_uf: $('#naturalidade_uf')?.value.trim().toUpperCase() || '',
          rg_numero: $('#rg_numero')?.value.trim() || '',
          rg_orgao: $('#rg_orgao')?.value.trim().toUpperCase() || '',
          rg_uf: $('#rg_uf')?.value.trim().toUpperCase() || '',
          rg_data: $('#rg_data')?.value || '',
          cpf: onlyDigits($('#cpf')?.value),
          nis: $('#nis')?.value.trim() || '',
          email: normalizeEmail($('#email')?.value),
          email_confirmacao: normalizeEmail($('#email_confirm')?.value),
          telefone1: onlyDigits($('#tel1')?.value),
          telefone2: onlyDigits($('#tel2')?.value),
          cep: onlyDigits($('#cep')?.value),
          logradouro: $('#logradouro')?.value.trim() || '',
          numero: $('#numero')?.value.trim() || '',
          complemento: $('#complemento')?.value.trim() || '',
          bairro: $('#bairro')?.value.trim() || '',
          cidade: $('#cidade')?.value.trim() || '',
          uf: $('#uf')?.value.trim().toUpperCase() || '',
          alistamento_numero: $('#alistamento_numero')?.value.trim() || '',
          alistamento_orgao: $('#alistamento_orgao')?.value.trim().toUpperCase() || '',
          alistamento_data: $('#alistamento_data')?.value || '',
          nivel_minimo: $('#nivel')?.value || '',
          ies: $('#ies')?.value.trim() || '',
          curso: $('#curso')?.value.trim() || '',
          ano_conclusao: $('#ano_conclusao')?.value.trim() || '',
          raca: $('#raca')?.value || '',
          concorrer_ppni: $('#cotasPPNI')?.value || '',
          is_pcd: $('#is_pcd')?.value || '',
          tipo_pcd: $('#tipo_pcd')?.value.trim() || '',
          pcd_cid: $('#pcd_cid')?.value.trim() || '',
          condicao_especial: document.querySelector('input[name="condicao_especial"]:checked')?.value || '',
          necessidade: $('#necessidade')?.value.trim() || '',
          militar: document.querySelector('input[name="militar"]:checked')?.value || '',
          politicos: document.querySelector('input[name="politicos"]:checked')?.value || '',
          titulo: onlyDigits($('#titulo')?.value),
          zona: onlyDigits($('#zona')?.value),
          secao: onlyDigits($('#secao')?.value),
          cargo: cargoValue,
          cargo_label: cargoLabel,
          especialidade: $('#especialidade')?.value.trim() || '',
          foi_jurado: $('#foi_jurado')?.value || '',
          jurado_periodo: $('#jurado_periodo')?.value.trim() || '',
          vinculo_publico: $('#vinculo_publico')?.value || '',
          qual_vinculo: $('#qual_vinculo')?.value.trim() || '',
          experiencia_tempo: $('#experiencia_tempo')?.value.trim() || '',
          termo_responsabilidade: responsibilityCheckbox && responsibilityCheckbox.checked ? 'ACEITO' : 'NAO',
          recurso_tipo: $('#recurso_tipo')?.value || '',
          recurso_texto: $('#recurso_texto')?.value.trim() || ''
        };
      }

      function getFileExtension(name){
        const match = /\.([^.]+)$/.exec(name || '');
        return match ? match[1].toLowerCase() : '';
      }

      async function fileToBase64(file){
        const buffer = await file.arrayBuffer();
        const bytes = new Uint8Array(buffer);
        const chunkSize = 0x8000;
        let binary = '';
        for(let i = 0; i < bytes.length; i += chunkSize){
          const chunk = bytes.subarray(i, i + chunkSize);
          binary += String.fromCharCode.apply(null, chunk);
        }
        return btoa(binary);
      }

      async function collectAttachments(){
        const defs = [
          { id:'doc_id_frente', campo:'doc_id_frente' },
          { id:'doc_id_verso', campo:'doc_id_verso' },
          { id:'doc_cpf', campo:'doc_cpf' },
          { id:'doc_residencia', campo:'doc_residencia' },
          { id:'doc_quitacao_eleitoral', campo:'doc_quitacao_eleitoral' },
          { id:'doc_militar', campo:'doc_militar' },
          { id:'doc_jurado', campo:'doc_jurado' },
          { id:'doc_jurado_440', campo:'doc_jurado_440' },
          { id:'doc_escolaridade', campo:'doc_escolaridade' },
          { id:'doc_curriculo', campo:'doc_curriculo' },
          { id:'het_declaracao', campo:'het_declaracao' },
          { id:'het_id', campo:'het_id' },
          { id:'het_frente', campo:'het_frente' },
          { id:'het_perfil', campo:'het_perfil' },
          { id:'het_video', campo:'het_video' },
          { id:'pcd_laudo', campo:'pcd_laudo' },
          { id:'pcd_declaracao', campo:'pcd_declaracao' },
          { id:'pcd_exames', campo:'pcd_exames' },
          { id:'recurso_anexo', campo:'recurso_anexo' }
        ];
        const attachments = [];
        for(const def of defs){
          const input = document.getElementById(def.id);
          if(!input || !input.files) continue;
          const files = Array.from(input.files);
          for(const file of files){
            const conteudo = await fileToBase64(file);
            attachments.push({
              campo: def.campo,
              nome: file.name,
              extensao: getFileExtension(file.name),
              conteudo
            });
          }
        }
        return attachments;
      }

      async function submitForm(event){
        event.preventDefault();
        if(!form) return;
        updateEmailFeedback();
        if(!form.checkValidity()){
          form.reportValidity();
          return;
        }
        if(statusEl){
          statusEl.textContent = 'Enviando dados...';
          statusEl.classList.remove('text-danger','text-success');
          statusEl.classList.add('text-muted');
        }
        if(outputEl){
          outputEl.textContent = '';
          outputEl.classList.add('d-none');
        }
        try{
          const dados = buildPayload();
          const anexos = await collectAttachments();
          const response = await fetch(FINAL_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ dados, anexos })
          });
          const text = await response.text();
          let data;
          try{ data = JSON.parse(text); }catch(e){}
          if(response.ok){
            if(statusEl){
              statusEl.textContent = 'Inscrição enviada com sucesso.';
              statusEl.classList.remove('text-danger','text-muted');
              statusEl.classList.add('text-success');
            }
            if(outputEl){
              outputEl.textContent = JSON.stringify(data ?? text, null, 2);
              outputEl.classList.remove('d-none');
            }
          }else{
            if(statusEl){
              statusEl.textContent = `Erro ao enviar (${response.status})`;
              statusEl.classList.remove('text-success','text-muted');
              statusEl.classList.add('text-danger');
            }
            if(outputEl){
              outputEl.textContent = text;
              outputEl.classList.remove('d-none');
            }
          }
        }catch(error){
          if(statusEl){
            statusEl.textContent = 'Não foi possível enviar a inscrição.';
            statusEl.classList.remove('text-success','text-muted');
            statusEl.classList.add('text-danger');
          }
          if(outputEl){
            outputEl.textContent = String(error);
            outputEl.classList.remove('d-none');
          }
        }
      }

      function init(){
        applyPrefill();
        syncRadioWithHidden('jurado_funcao','foi_jurado');
        syncRadioWithHidden('vinculo_publico_opcao','vinculo_publico');
        toggleGeneroOutro();
        toggleGeneroDependents();
        toggleJuradoDetails();
        toggleVinculoDetails();
        togglePcdDetails();
        toggleHeteroDocs();
        updateEmailFeedback();
        updateNecessidadeRequirement();
        updateResourceAreaVisibility();
        autofillAddressByCep();
      }

      $('#genero')?.addEventListener('change', toggleGeneroOutro);
      $('#sexo')?.addEventListener('change', toggleGeneroDependents);
      document.querySelectorAll('input[name="jurado_funcao"]').forEach((radio) => {
        radio.addEventListener('change', () => {
          const hidden = document.getElementById('foi_jurado');
          if(hidden && radio.checked){
            hidden.value = radio.value;
            toggleJuradoDetails();
          }
        });
      });
      document.querySelectorAll('input[name="vinculo_publico_opcao"]').forEach((radio) => {
        radio.addEventListener('change', () => {
          const hidden = document.getElementById('vinculo_publico');
          if(hidden && radio.checked){
            hidden.value = radio.value;
            toggleVinculoDetails();
          }
        });
      });
      $('#is_pcd')?.addEventListener('change', togglePcdDetails);
      $('#cotasPPNI')?.addEventListener('change', toggleHeteroDocs);
      document.querySelectorAll('input[name="condicao_especial"]').forEach((radio) => {
        radio.addEventListener('change', updateNecessidadeRequirement);
      });
      $('#email')?.addEventListener('input', updateEmailFeedback);
      $('#email_confirm')?.addEventListener('input', updateEmailFeedback);
      $('#cep')?.addEventListener('blur', autofillAddressByCep);

      if(form){
        form.addEventListener('submit', submitForm);
      }

      init();
    </script>
  </body>
</html>
