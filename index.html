<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Secretaria de Administra√ß√£o - SAD ‚Äî Sele√ß√£o Simplificada Hospital Veterin√°rio do Recife</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
      :root {
        --brand-primary: #0053a4;
        --brand-secondary: #003a73;
        --brand-highlight: #00a3ff;
        --surface: #f4f7fb;
        --surface-strong: #ffffff;
        --border-color: #d0d7e2;
        --text-strong: #1b263b;
        --text-muted: #5b6c8c;
      }

      *, *::before, *::after {
        box-sizing: border-box;
      }

      body {
        font-family: "Public Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: var(--surface);
        color: var(--text-strong);
        min-height: 100vh;
      }

      header.site-header {
        background: linear-gradient(135deg, rgba(0, 83, 164, 0.96), rgba(0, 58, 115, 0.88));
        color: #ffffff;
        padding: 3.5rem 0 2.75rem;
      }

      header .lead {
        color: rgba(255, 255, 255, 0.82);
        max-width: 100%;
        font-size: 1rem;
        line-height: 1.65;
        text-align: justify;
      }

      .badge-open {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.95rem;
        font-weight: 600;
        padding: 0.45rem 0.9rem;
        border-radius: 999px;
        background-color: rgba(255, 255, 255, 0.14);
      }

      .user-greeting {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.05rem;
        font-weight: 600;
        margin-bottom: 2rem;
        padding: 1rem 1.5rem;
        border-radius: 1rem;
        background: linear-gradient(135deg, rgba(0, 83, 164, 0.09), rgba(0, 163, 255, 0.12));
        color: var(--text-strong);
        box-shadow: 0 10px 30px rgba(0, 45, 98, 0.08);
      }

      .user-greeting::before {
        content: "üëã";
        font-size: 1.4rem;
      }

      .collapsible-form {
        border: 1px solid rgba(0, 83, 164, 0.15);
        border-radius: 0.9rem;
        background: rgba(0, 83, 164, 0.05);
        padding: 1rem 1.25rem;
      }

      .collapsible-form summary {
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        list-style: none;
      }

      .collapsible-form summary::marker {
        display: none;
      }

      .collapsible-form summary::-webkit-details-marker {
        display: none;
      }

      .collapsible-form summary::before {
        content: "‚ûï";
        font-size: 0.9rem;
        transition: transform 0.2s ease;
      }

      .collapsible-form[open] summary::before {
        transform: rotate(45deg);
      }

      .collapsible-form .form-label {
        font-weight: 600;
        color: var(--text-strong);
      }

      .collapsible-form .form-text {
        color: var(--text-muted);
      }

      .feedback-modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(27, 38, 59, 0.45);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
        z-index: 1050;
      }

      .feedback-modal-backdrop.active {
        display: flex;
      }

      .feedback-modal {
        background: #ffffff;
        border-radius: 1rem;
        max-width: 420px;
        width: 100%;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.18);
        padding: 1.75rem;
      }

      .feedback-modal-title {
        font-weight: 700;
        font-size: 1.1rem;
        margin-bottom: 0.75rem;
        color: var(--text-strong);
      }

      .feedback-modal button {
        border-radius: 999px;
        padding-inline: 1.5rem;
        font-weight: 600;
      }

      #publicacoes-list time {
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        color: var(--brand-secondary);
        letter-spacing: 0.05em;
      }

      .section-title {
        display: flex;
        align-items: center;
        gap: 0.65rem;
        font-weight: 700;
        font-size: 1.2rem;
        letter-spacing: 0.02em;
        color: var(--text-strong);
      }

      .section-title::before {
        content: "";
        display: inline-block;
        width: 32px;
        height: 3px;
        border-radius: 999px;
        background: var(--brand-highlight);
      }

      .card-programa {
        border: 1px solid rgba(0, 83, 164, 0.08);
        border-radius: 1.1rem;
        background: var(--surface-strong);
        box-shadow: 0 16px 34px rgba(0, 45, 98, 0.08);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        height: 100%;
      }

      .card-programa:hover {
        transform: translateY(-6px);
        box-shadow: 0 20px 38px rgba(0, 45, 98, 0.12);
      }

      .card-programa .card-header {
        border-bottom: 1px solid rgba(0, 83, 164, 0.08);
        background: linear-gradient(180deg, #ffffff 0%, #f5f8fc 100%);
        padding: 1.5rem 1.6rem 1.1rem;
      }

      .card-programa .card-body {
        padding: 1.6rem 1.6rem 1.75rem;
      }

      .card-programa .badge {
        border-radius: 999px;
        font-weight: 600;
        letter-spacing: 0.04em;
      }

      .card-programa ul {
        padding-left: 1.25rem;
        margin-bottom: 1.25rem;
        color: var(--text-muted);
      }

      .card-programa .btn {
        border-radius: 999px;
        padding-inline: 1.6rem;
        font-weight: 600;
        letter-spacing: 0.01em;
      }

      .downloads-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.25rem;
      }

      .download-card {
        border: 1px solid var(--border-color);
        background: var(--surface-strong);
        border-radius: 1rem;
        padding: 1.35rem 1.4rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        min-height: 170px;
      }

      .download-card strong {
        font-size: 1rem;
        color: var(--text-strong);
      }

      .download-card p {
        margin: 0;
        color: var(--text-muted);
        font-size: 0.95rem;
        line-height: 1.4;
      }

      .download-card a {
        font-weight: 600;
      }

      .updates-panel {
        border-left: 3px solid var(--brand-highlight);
        padding-left: 1.2rem;
        color: var(--text-muted);
      }

      .updates-panel time {
        font-size: 0.85rem;
        color: var(--brand-secondary);
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }

      footer {
        color: var(--text-muted);
        padding: 2.5rem 0 2rem;
        font-size: 0.9rem;
      }

      @media (max-width: 768px) {
        header.site-header {
          padding: 2.5rem 0 2rem;
        }

        .badge-open {
          width: 100%;
          justify-content: center;
        }

        .section-title {
          justify-content: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <input type="hidden" id="authorization" value="{{ $('Code in JavaScript2').item.json.authorization }}" />
    <input type="hidden" id="cpf" value="{{ $json.cpf }}" />
    <input type="hidden" id="email" value="{{ $json.email }}" />
    <input type="hidden" id="telefone" value="{{ $json.telefone }}" />
    <input type="hidden" id="cep" value="{{ $json.cep }}" />
    <input type="hidden" id="logradouro" value="{{ $json.logradouro }}" />
    <input type="hidden" id="numero" value="{{ $json.numero }}" />
    <input type="hidden" id="complemento" value="{{ $json.complemento }}" />
    <input type="hidden" id="bairro" value="{{ $json.bairro }}" />
    <input type="hidden" id="cidade" value="{{ $json.cidade }}" />
    <input type="hidden" id="uf" value="{{ $json.uf }}" />
    <header class="site-header">
      <div class="container">
        <span class="badge-open">Secretaria de Administra√ß√£o - SAD ‚Ä¢ Recife</span>
        <h1 class="display-6 fw-semibold mt-3">Sele√ß√£o Simplificada Hospital Veterin√°rio do Recife</h1>
        <p class="lead mt-2">
          A SECRETARIA DE ADMINISTRA√á√ÉO e o GABINETE DE PROTE√á√ÉO E DEFESA DOS ANIMAIS, com fundamento no Decreto n¬∫ XXXXX, de XX de XXXXXXXX de 2025,
          tornam p√∫blica a abertura da SELE√á√ÉO P√öBLICA SIMPLIFICADA destinada √† contrata√ß√£o tempor√°ria de 41 (quarenta e um) profissionais, sendo 37
          (trinta e sete) vagas para Analista em Sa√∫de Animal ‚Äì Veterin√°rio, 02 (duas) vagas para T√©cnico em Sa√∫de Animal ‚Äì Radiologia e Imagenologia e
          02 (duas) vagas para Auxiliar em Sa√∫de Animal ‚Äì Auxiliar Veterin√°rio, para atua√ß√£o no Hospital Veterin√°rio do Recife Robson Jos√© Gomes de
          Melo, vinculado ao Gabinete de Prote√ß√£o e Defesa dos Animais, a fim de atender necessidade tempor√°ria de excepcional interesse p√∫blico.
        </p>
      </div>
    </header>

    <main class="container my-5">
      <p class="user-greeting">Ol√°, {{ $json.given_name }}! Que bom ter voc√™ aqui.</p>
      <section class="mb-5">
        <div class="d-flex flex-wrap justify-content-between align-items-start gap-3 mb-4">
          <h2 class="section-title mb-0">Inscri√ß√µes em andamento</h2>
          <div class="text-muted small">
            √öltima atualiza√ß√£o em <strong>outubro de 2025</strong> ‚Ä¢ Hor√°rio oficial do Recife (GMT-3)
          </div>
        </div>

        <div class="row g-4">
          <div class="col-lg-6">
            <article class="card card-programa">
              <div class="card-header">
                <span class="badge text-bg-light text-uppercase text-primary">Sele√ß√£o simplificada</span>
                <h3 class="h5 mt-3 mb-1">Hospital Veterin√°rio do Recife</h3>
                <p class="mb-0 text-muted">Processo seletivo para contrata√ß√£o tempor√°ria ‚Äî Edital SAD N¬∫ 01/2025</p>
              </div>
              <div class="card-body">
                <ul class="mb-0">
                  <li>Per√≠odo de inscri√ß√£o: 10 a 24 de outubro de 2025.</li>
                  <li>Envio de documentos comprobat√≥rios em formato PDF.</li>
                  <li>Etapas conduzidas no Sistema SAD Sele√ß√µes.</li>
                </ul>
                <div class="d-flex flex-wrap gap-2 mt-4">
                  <button class="btn btn-primary px-4 py-2" id="btn-preencher-inscricao" type="button">Preencher formul√°rio de inscri√ß√£o</button>
                </div>
              </div>
            </article>
          </div>

          <div class="col-lg-6 d-flex flex-column gap-4">
            <section class="publicacoes-panel bg-white rounded-4 border shadow-sm p-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="h6 text-uppercase text-secondary mb-0">Publica√ß√µes</h3>
                <span class="badge text-bg-light text-primary">Atualizado automaticamente</span>
              </div>
              <ul class="list-unstyled mb-0" id="publicacoes-list">
                <li class="text-muted">Carregando publica√ß√µes...</li>
              </ul>
            </section>
            <article class="card card-programa">
              <div class="card-header">
                <span class="badge text-bg-light text-uppercase text-primary">Atualiza√ß√£o cadastral</span>
                <h3 class="h5 mt-3 mb-1">Hospital Veterin√°rio ‚Äî Cadastro de Reservas</h3>
                <p class="mb-0 text-muted">Atualize exclusivamente e-mail, telefone e endere√ßo para manter o cadastro atualizado.</p>
              </div>
              <div class="card-body">
                <ul class="mb-0">
                  <li>Revise e confirme os dados antes de enviar a atualiza√ß√£o.</li>
                  <li>As informa√ß√µes ser√£o atualizadas em seu cadastro.</li>
                </ul>
                <details class="collapsible-form mt-3">
                  <summary>Atualizar dados de contato</summary>
                  <div class="mt-3">
                    <label class="form-label" for="email-input">E-mail</label>
                    <input class="form-control" type="email" id="email-input" name="email" value="{{ $json.email }}" placeholder="nome@exemplo.com" autocomplete="email" required />
                    <div class="form-text">Informe o endere√ßo eletr√¥nico que receber√° os comunicados oficiais.</div>
                  </div>
                  <div class="mt-3">
                    <label class="form-label" for="email-confirm-input">Confirmar e-mail</label>
                    <input class="form-control" type="email" id="email-confirm-input" name="emailConfirm" value="" placeholder="Confirme seu e-mail" autocomplete="email" required />
                    <div class="form-text">Digite novamente para validar o endere√ßo informado.</div>
                  </div>
                  <div class="mt-3">
                    <label class="form-label" for="telefone-input">Telefone</label>
                    <input class="form-control" type="tel" id="telefone-input" name="telefone" value="{{ $json.telefone }}" placeholder="DDD + n√∫mero" inputmode="numeric" maxlength="11" required />
                    <div class="form-text">Informe 11 d√≠gitos num√©ricos (ex.: 81999999999) para contato preferencial.</div>
                  </div>
                  <div class="mt-3">
                    <label class="form-label" for="cep-input">CEP</label>
                    <input class="form-control" type="text" id="cep-input" name="cep" value="{{ $json.cep }}" placeholder="00000000" inputmode="numeric" maxlength="8" required />
                    <div class="form-text">Informe o CEP com 8 d√≠gitos.</div>
                  </div>
                  <div class="row g-3 mt-3">
                    <div class="col-md-8">
                      <label class="form-label" for="logradouro-input">Logradouro</label>
                      <input class="form-control" type="text" id="logradouro-input" name="logradouro" value="{{ $json.logradouro }}" placeholder="Rua, avenida, travessa..." required />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label" for="numero-input">N√∫mero</label>
                      <input class="form-control" type="text" id="numero-input" name="numero" value="{{ $json.numero }}" placeholder="000" required />
                    </div>
                  </div>
                  <div class="mt-3">
                    <label class="form-label" for="complemento-input">Complemento</label>
                    <input class="form-control" type="text" id="complemento-input" name="complemento" value="{{ $json.complemento }}" placeholder="Apartamento, bloco, refer√™ncia" required />
                  </div>
                  <div class="row g-3 mt-3">
                    <div class="col-md-6">
                      <label class="form-label" for="bairro-input">Bairro</label>
                      <input class="form-control" type="text" id="bairro-input" name="bairro" value="{{ $json.bairro }}" placeholder="Nome do bairro" required />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label" for="cidade-input">Cidade</label>
                      <input class="form-control" type="text" id="cidade-input" name="cidade" value="{{ $json.cidade }}" placeholder="Munic√≠pio" required />
                    </div>
                    <div class="col-md-2">
                      <label class="form-label" for="uf-input">UF</label>
                      <input class="form-control text-uppercase" type="text" id="uf-input" name="uf" value="{{ $json.uf }}" placeholder="UF" maxlength="2" required />
                    </div>
                  </div>
                </details>
                <button class="btn btn-outline-primary mt-3" id="btn-atualizar-cadastro" type="button" disabled>Enviar atualiza√ß√£o de contato</button>
              </div>
            </article>
          </div>
        </div>
      </section>

      <section class="mb-5">
        <h2 class="section-title mb-3">Documentos obrigat√≥rios e modelos</h2>
        <p class="text-muted mb-4">
          Utilize os modelos oficiais disponibilizados abaixo. Todos os anexos devem ser assinados, digitalizados em alta
          resolu√ß√£o e enviados em formato PDF conforme orienta√ß√µes do edital.
        </p>

        <div class="downloads-grid">
          <article class="download-card">
            <strong>Modelo de Laudo M√©dico para Pessoas com Defici√™ncia</strong>
            <p>Documento comprobat√≥rio exigido para candidatos que solicitam reserva de vagas PcD.</p>
            <a class="link-primary" href="FORM%20MODELO%20DE%20LAUDO%20M√âDICO%20PARA%20PESSOAS%20COM%20DEFICI√äNCIA.pdf" target="_blank" rel="noopener">Baixar modelo em PDF</a>
          </article>

          <article class="download-card">
            <strong>Termo de Autodeclara√ß√£o ‚Äî Candidatos Negros (Preto e Pardo)</strong>
            <p>Assinatura obrigat√≥ria para candidatos que optarem pela reserva de vagas para pessoas negras.</p>
            <a class="link-primary" href="FORM%20TERMO%20DE%20AUTODECLARA√á√ÉO%20DE%20CANDIDATOS%20NEGROS%20(PRETO%20E%20PARDO).pdf" target="_blank" rel="noopener">Baixar termo em PDF</a>
          </article>

          <article class="download-card">
            <strong>Termo de Autodeclara√ß√£o de Identidade Ind√≠gena (TADII)</strong>
            <p>Documento exigido para autodeclara√ß√£o de pertencimento a povos ind√≠genas.</p>
            <a class="link-primary" href="FORM%20TERMO%20DE%20AUTODECLARA√á√ÉO%20DE%20IDENTIDADE%20IND√çGENA%20-%20TADII.pdf" target="_blank" rel="noopener">Baixar termo em PDF</a>
          </article>
        </div>
      </section>

      <section class="row g-4 align-items-start mb-5">
        <div class="col-lg-7">
          <h2 class="section-title mb-3">Orienta√ß√µes para inscri√ß√£o</h2>
          <ol class="list-group list-group-numbered shadow-sm">
            <li class="list-group-item">
              Leia atentamente o edital e verifique os requisitos de participa√ß√£o, prazos e crit√©rios de classifica√ß√£o.
            </li>
            <li class="list-group-item">
              Separe toda a documenta√ß√£o obrigat√≥ria em formato PDF, com tamanho m√°ximo de 10&nbsp;MB por arquivo.
            </li>
            <li class="list-group-item">
              Utilize o formul√°rio eletr√¥nico para preencher seus dados pessoais, profissionais e anexar a documenta√ß√£o.
            </li>
            <li class="list-group-item">
              Ap√≥s o envio, acompanhe o e-mail cadastrado e o portal oficial para publica√ß√µes de listas e comunicados.
            </li>
          </ol>
        </div>
        <div class="col-lg-5">
          <div class="updates-panel bg-white rounded-4 p-4 shadow-sm">
            <h3 class="h6 text-uppercase text-secondary fw-bold mb-3">Orienta√ß√µes adicionais</h3>
            <p class="mb-2">Mantenha seus dados de contato atualizados para receber comunicados oficiais sobre o andamento do certame.</p>
            <p class="mb-0">As publica√ß√µes com listas, retifica√ß√µes e convoca√ß√µes ser√£o disponibilizadas automaticamente na √°rea "Publica√ß√µes" acima.</p>
          </div>
        </div>
      </section>

      <section class="mb-5">
        <h2 class="section-title mb-3">Canais de suporte</h2>
        <div class="row g-3">
          <div class="col-md-4">
            <div class="p-4 bg-white rounded-4 border shadow-sm h-100">
              <h3 class="h6 text-uppercase text-secondary">Atendimento eletr√¥nico</h3>
              <p class="mb-1 fw-semibold">sad.selecao@recife.pe.gov.br</p>
              <p class="mb-0 text-muted">Resposta em at√© 2 dias √∫teis.</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-4 bg-white rounded-4 border shadow-sm h-100">
              <h3 class="h6 text-uppercase text-secondary">Telefone</h3>
              <p class="mb-1 fw-semibold">(81) 3355-0000</p>
              <p class="mb-0 text-muted">Segunda a sexta-feira, das 9h √†s 16h.</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-4 bg-white rounded-4 border shadow-sm h-100">
              <h3 class="h6 text-uppercase text-secondary">Atendimento presencial</h3>
              <p class="mb-1 fw-semibold">Av. Cais do Apolo, 925 ‚Äî Bairro do Recife</p>
              <p class="mb-0 text-muted">Agendamento pr√©vio obrigat√≥rio.</p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="bg-white border-top">
      <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between gap-2">
        <span>Secretaria de Administra√ß√£o - SAD ‚Äî Prefeitura do Recife</span>
        <span class="text-muted">¬© 2025 ‚Ä¢ Coordenadoria de Processos Seletivos</span>
      </div>
    </footer>
    <div class="feedback-modal-backdrop" id="feedback-modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="feedback-modal">
        <h4 class="feedback-modal-title" id="feedback-modal-title"></h4>
        <p class="mb-0" id="feedback-modal-message"></p>
        <button type="button" class="btn btn-primary mt-4" id="feedback-modal-close">Fechar</button>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var button = document.getElementById("btn-preencher-inscricao");
        var authorizationField = document.getElementById("authorization");
        var targetUrl = "https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/47e510d9-7e40-4191-a7b9-8993e2a05eb7";
        var redirectUrl = "https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/47e510d9-7e40-4191-a7b9-8993e2a05eb7";
        var updateButton = document.getElementById("btn-atualizar-cadastro");
        var emailInput = document.getElementById("email-input");
        var emailConfirmInput = document.getElementById("email-confirm-input");
        var telefoneInput = document.getElementById("telefone-input");
        var cepInput = document.getElementById("cep-input");
        var logradouroInput = document.getElementById("logradouro-input");
        var numeroInput = document.getElementById("numero-input");
        var complementoInput = document.getElementById("complemento-input");
        var bairroInput = document.getElementById("bairro-input");
        var cidadeInput = document.getElementById("cidade-input");
        var ufInput = document.getElementById("uf-input");
        var emailHidden = document.getElementById("email");
        var telefoneHidden = document.getElementById("telefone");
        var cepHidden = document.getElementById("cep");
        var logradouroHidden = document.getElementById("logradouro");
        var numeroHidden = document.getElementById("numero");
        var complementoHidden = document.getElementById("complemento");
        var bairroHidden = document.getElementById("bairro");
        var cidadeHidden = document.getElementById("cidade");
        var ufHidden = document.getElementById("uf");
        var modalBackdrop = document.getElementById("feedback-modal");
        var modalTitle = document.getElementById("feedback-modal-title");
        var modalMessage = document.getElementById("feedback-modal-message");
        var modalClose = document.getElementById("feedback-modal-close");
        var lastCepConsulted = "";

        function sanitizeDigits(value) {
          return (value || "").replace(/\D/g, "");
        }

        function determineToneFromContent(message, data) {
          var normalizedMessage = (message || "").toLowerCase();
          var statusField = "";

          if (data && typeof data === "object" && !Array.isArray(data)) {
            if (data.status) {
              statusField = String(data.status).toLowerCase();
            } else if (data.result) {
              statusField = String(data.result).toLowerCase();
            } else if (data.type) {
              statusField = String(data.type).toLowerCase();
            } else if (data.title) {
              statusField = String(data.title).toLowerCase();
            }
          }

          if (statusField.includes("sucesso") || statusField === "success" || statusField === "ok") {
            return "success";
          }
          if (statusField.includes("erro") || statusField.includes("error") || statusField.includes("falha") || statusField.includes("fail")) {
            return "error";
          }

          if (normalizedMessage.includes("sucesso") || normalizedMessage.includes("atualiz")) {
            return "success";
          }
          if (
            normalizedMessage.includes("erro") ||
            normalizedMessage.includes("falha") ||
            normalizedMessage.includes("inv√°lid") ||
            normalizedMessage.includes("n√£o foi poss√≠vel")
          ) {
            return "error";
          }
          if (
            normalizedMessage.includes("aten√ß√£o") ||
            normalizedMessage.includes("aguarde") ||
            normalizedMessage.includes("verifique") ||
            normalizedMessage.includes("pendente")
          ) {
            return "warning";
          }
          return null;
        }

        function showPopup(message, options) {
          var msg = message === undefined || message === null ? "" : String(message);
          var toneHint = options && options.tone;
          var tone = toneHint || determineToneFromContent(msg, options && options.data);
          var title;

          switch (tone) {
            case "success":
              title = "‚úÖ Sucesso";
              break;
            case "error":
              title = "‚ùå Erro";
              break;
            case "warning":
              title = "‚ö†Ô∏è Aten√ß√£o";
              break;
            default:
              title = "‚ÑπÔ∏è Informativo";
              break;
          }

          if (modalTitle) {
            modalTitle.textContent = title;
          }
          if (modalMessage) {
            var trimmedMessage = msg.trim();
            var complementoAviso = "Atualize tamb√©m as suas informa√ß√µes cadastrais no ConectaRecife.";
            var finalMessage = trimmedMessage ? trimmedMessage + " " + complementoAviso : complementoAviso;
            modalMessage.textContent = finalMessage;
          }
          if (modalBackdrop) {
            modalBackdrop.classList.add("active");
            modalBackdrop.setAttribute("aria-hidden", "false");
          }
          if (modalClose) {
            modalClose.focus();
          }
        }

        function hidePopup() {
          if (modalBackdrop) {
            modalBackdrop.classList.remove("active");
            modalBackdrop.setAttribute("aria-hidden", "true");
          }
        }

        if (modalClose) {
          modalClose.addEventListener("click", hidePopup);
        }
        if (modalBackdrop) {
          modalBackdrop.addEventListener("click", function (event) {
            if (event.target === modalBackdrop) {
              hidePopup();
            }
          });
        }
        document.addEventListener("keydown", function (event) {
          if (event.key === "Escape") {
            hidePopup();
          }
        });

        function collectUpdateValues() {
          var cpfField = document.getElementById("cpf");
          var emailValue = emailInput ? emailInput.value.trim().toLowerCase() : "";
          var emailConfirmValue = emailConfirmInput ? emailConfirmInput.value.trim().toLowerCase() : "";
          var telefoneValue = telefoneInput ? sanitizeDigits(telefoneInput.value) : "";
          var cepValue = cepInput ? sanitizeDigits(cepInput.value) : "";
          var logradouroValue = logradouroInput ? logradouroInput.value.trim().toUpperCase() : "";
          var numeroValue = numeroInput ? numeroInput.value.trim().toUpperCase() : "";
          var complementoValue = complementoInput ? complementoInput.value.trim().toUpperCase() : "";
          var bairroValue = bairroInput ? bairroInput.value.trim().toUpperCase() : "";
          var cidadeValue = cidadeInput ? cidadeInput.value.trim().toUpperCase() : "";
          var ufValue = ufInput ? String(ufInput.value || "").replace(/[^a-zA-Z]/g, "").slice(0, 2).toUpperCase() : "";

          if (emailInput && emailInput.value !== emailValue) {
            emailInput.value = emailValue;
          }
          if (emailConfirmInput && emailConfirmInput.value !== emailConfirmValue) {
            emailConfirmInput.value = emailConfirmValue;
          }
          if (telefoneInput && telefoneInput.value !== telefoneValue) {
            telefoneInput.value = telefoneValue;
          }
          if (cepInput && cepInput.value !== cepValue) {
            cepInput.value = cepValue;
          }
          if (logradouroInput && logradouroInput.value !== logradouroValue) {
            logradouroInput.value = logradouroValue;
          }
          if (numeroInput && numeroInput.value !== numeroValue) {
            numeroInput.value = numeroValue;
          }
          if (complementoInput && complementoInput.value !== complementoValue) {
            complementoInput.value = complementoValue;
          }
          if (bairroInput && bairroInput.value !== bairroValue) {
            bairroInput.value = bairroValue;
          }
          if (cidadeInput && cidadeInput.value !== cidadeValue) {
            cidadeInput.value = cidadeValue;
          }
          if (ufInput && ufInput.value !== ufValue) {
            ufInput.value = ufValue;
          }

          return {
            cpf: cpfField ? cpfField.value : "",
            email: emailValue,
            emailConfirm: emailConfirmValue,
            telefone: telefoneValue,
            cep: cepValue,
            logradouro: logradouroValue,
            numero: numeroValue,
            complemento: complementoValue,
            bairro: bairroValue,
            cidade: cidadeValue,
            uf: ufValue,
          };
        }

        function syncHiddenValues(values) {
          if (!values) {
            return;
          }
          if (emailHidden) {
            emailHidden.value = values.email || "";
          }
          if (telefoneHidden) {
            telefoneHidden.value = values.telefone || "";
          }
          if (cepHidden) {
            cepHidden.value = values.cep || "";
          }
          if (logradouroHidden) {
            logradouroHidden.value = values.logradouro || "";
          }
          if (numeroHidden) {
            numeroHidden.value = values.numero || "";
          }
          if (complementoHidden) {
            complementoHidden.value = values.complemento || "";
          }
          if (bairroHidden) {
            bairroHidden.value = values.bairro || "";
          }
          if (cidadeHidden) {
            cidadeHidden.value = values.cidade || "";
          }
          if (ufHidden) {
            ufHidden.value = values.uf || "";
          }
        }

        function computeValidationState(values) {
          var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          var state = {
            emailValid: emailPattern.test(values.email),
            emailConfirmValid: emailPattern.test(values.emailConfirm),
            emailsMatch: !!values.email && values.email === values.emailConfirm,
            telefoneValid: /^\d{11}$/.test(values.telefone),
            cepValid: /^\d{8}$/.test(values.cep),
            logradouroValid: !!values.logradouro,
            numeroValid: !!values.numero,
            complementoValid: !!values.complemento,
            bairroValid: !!values.bairro,
            cidadeValid: !!values.cidade,
            ufValid: /^[A-Z]{2}$/.test(values.uf),
          };

          state.allFieldsFilled =
            !!values.email &&
            !!values.emailConfirm &&
            !!values.telefone &&
            !!values.cep &&
            !!values.logradouro &&
            !!values.numero &&
            !!values.complemento &&
            !!values.bairro &&
            !!values.cidade &&
            !!values.uf;

          state.isValid =
            state.emailValid &&
            state.emailConfirmValid &&
            state.emailsMatch &&
            state.telefoneValid &&
            state.cepValid &&
            state.logradouroValid &&
            state.numeroValid &&
            state.complementoValid &&
            state.bairroValid &&
            state.cidadeValid &&
            state.ufValid;

          return state;
        }

        function updateValidationFeedback(state, forceHighlight) {
          if (!state) {
            return;
          }

          if (emailInput) {
            emailInput.classList.toggle("is-invalid", !state.emailValid || !state.emailsMatch);
          }
          if (emailConfirmInput) {
            emailConfirmInput.classList.toggle("is-invalid", !state.emailConfirmValid || !state.emailsMatch);
          }

          var validityMap = [
            [telefoneInput, state.telefoneValid],
            [cepInput, state.cepValid],
            [logradouroInput, state.logradouroValid],
            [numeroInput, state.numeroValid],
            [complementoInput, state.complementoValid],
            [bairroInput, state.bairroValid],
            [cidadeInput, state.cidadeValid],
            [ufInput, state.ufValid],
          ];

          var shouldHighlight = forceHighlight || state.allFieldsFilled;

          validityMap.forEach(function (entry) {
            var field = entry[0];
            var valid = entry[1];
            if (field) {
              field.classList.toggle("is-invalid", !valid && shouldHighlight);
            }
          });
        }

        function updateSubmitButton(state) {
          if (updateButton) {
            updateButton.disabled = !state || !state.isValid;
          }
        }

        function validateUpdateData(values) {
          var state = computeValidationState(values);
          var messages = [];

          if (!state.emailValid) {
            messages.push("Informe um e-mail v√°lido.");
          }
          if (!state.emailConfirmValid) {
            messages.push("Confirme o e-mail com um endere√ßo v√°lido.");
          }
          if (state.emailValid && state.emailConfirmValid && !state.emailsMatch) {
            messages.push("Os campos de e-mail devem ser id√™nticos.");
          }
          if (!state.telefoneValid) {
            messages.push("O telefone deve conter exatamente 11 d√≠gitos num√©ricos.");
          }
          if (!state.cepValid) {
            messages.push("Informe um CEP com 8 d√≠gitos.");
          }
          if (!state.logradouroValid) {
            messages.push("Preencha o logradouro.");
          }
          if (!state.numeroValid) {
            messages.push("Informe o n√∫mero do endere√ßo.");
          }
          if (!state.complementoValid) {
            messages.push("Informe o complemento do endere√ßo.");
          }
          if (!state.bairroValid) {
            messages.push("Preencha o bairro.");
          }
          if (!state.cidadeValid) {
            messages.push("Informe a cidade.");
          }
          if (!state.ufValid) {
            messages.push("Informe a UF com duas letras.");
          }

          messages.state = state;
          return messages;
        }

        function handleCepLookup() {
          if (!cepInput) {
            return;
          }

          var cepValue = sanitizeDigits(cepInput.value);
          if (cepValue.length !== 8) {
            lastCepConsulted = "";
            return;
          }

          if (cepValue === lastCepConsulted) {
            return;
          }

          lastCepConsulted = cepValue;

          fetch("https://brasilapi.com.br/api/cep/v1/" + cepValue)
            .then(function (response) {
              if (!response.ok) {
                throw new Error("CEP n√£o encontrado");
              }
              return response.json();
            })
            .then(function (data) {
              if (data) {
                if (logradouroInput && data.street) {
                  logradouroInput.value = String(data.street).toUpperCase();
                }
                if (bairroInput && data.neighborhood) {
                  bairroInput.value = String(data.neighborhood).toUpperCase();
                }
                if (cidadeInput && data.city) {
                  cidadeInput.value = String(data.city).toUpperCase();
                }
                if (ufInput && data.state) {
                  ufInput.value = String(data.state).toUpperCase();
                }
              }
              handleInputChange();
            })
            .catch(function (error) {
              lastCepConsulted = "";
              console.error("Erro ao consultar CEP:", error);
              showPopup("N√£o encontramos informa√ß√µes para o CEP informado. Voc√™ pode preencher os campos manualmente.", { tone: "warning" });
            });
        }

        function handleInputChange() {
          var values = collectUpdateValues();
          syncHiddenValues(values);
          var state = computeValidationState(values);
          updateValidationFeedback(state, false);
          updateSubmitButton(state);
        }

        if (telefoneInput) {
          telefoneInput.addEventListener("input", function () {
            var sanitized = sanitizeDigits(telefoneInput.value).slice(0, 11);
            if (telefoneInput.value !== sanitized) {
              telefoneInput.value = sanitized;
            }
            handleInputChange();
          });
          telefoneInput.value = sanitizeDigits(telefoneInput.value).slice(0, 11);
        }

        if (cepInput) {
          cepInput.addEventListener("input", function () {
            var sanitized = sanitizeDigits(cepInput.value).slice(0, 8);
            if (cepInput.value !== sanitized) {
              cepInput.value = sanitized;
            }
            handleInputChange();
          });
          cepInput.addEventListener("keyup", handleCepLookup);
          cepInput.addEventListener("change", handleCepLookup);
          cepInput.addEventListener("blur", handleCepLookup);
          cepInput.value = sanitizeDigits(cepInput.value).slice(0, 8);
        }

        if (cepInput && ufInput) {
          var initialCep = sanitizeDigits(cepInput.value);
          var initialUf = String(ufInput.value || "").trim().toUpperCase();
          if (initialCep.length === 8 && (!initialUf || initialUf === "UN")) {
            lastCepConsulted = "";
            handleCepLookup();
          }
        }

        if (ufInput) {
          ufInput.addEventListener("input", function () {
            var sanitized = String(ufInput.value || "").replace(/[^a-zA-Z]/g, "").slice(0, 2).toUpperCase();
            if (ufInput.value !== sanitized) {
              ufInput.value = sanitized;
            }
            handleInputChange();
          });
          ufInput.value = String(ufInput.value || "").replace(/[^a-zA-Z]/g, "").slice(0, 2).toUpperCase();
        }

        [emailInput, emailConfirmInput, telefoneInput, cepInput, logradouroInput, numeroInput, complementoInput, bairroInput, cidadeInput, ufInput]
          .filter(function (input) {
            return !!input;
          })
          .forEach(function (input) {
            input.addEventListener("input", handleInputChange);
            input.addEventListener("blur", handleInputChange);
          });

        handleInputChange();

        function getEmojiForUrl(url) {
          var extension = (url.split(".").pop() || "").toLowerCase();
          if (extension.includes("pdf")) return "üìÑ";
          if (["xls", "xlsx", "csv"].includes(extension)) return "üìä";
          if (["doc", "docx", "odt"].includes(extension)) return "üìù";
          if (["png", "jpg", "jpeg", "gif", "bmp", "svg"].includes(extension)) return "üñºÔ∏è";
          if (["zip", "rar", "7z"].includes(extension)) return "üóÇÔ∏è";
          if (["mp4", "mov", "avi", "mkv", "webm"].includes(extension)) return "üé¨";
          if (["mp3", "wav", "ogg"].includes(extension)) return "üéß";
          return "üîó";
        }

        function parseDate(raw) {
          if (!raw || typeof raw !== "string") {
            return null;
          }

          var normalized = raw.trim();
          var directDate = new Date(normalized);
          if (!isNaN(directDate.getTime())) {
            return directDate;
          }

          var brPattern = /^([0-3]?\d)\/([0-1]?\d)\/(\d{4})$/;
          var match = normalized.match(brPattern);
          if (match) {
            var day = parseInt(match[1], 10);
            var month = parseInt(match[2], 10) - 1;
            var year = parseInt(match[3], 10);
            var parsed = new Date(year, month, day);
            return isNaN(parsed.getTime()) ? null : parsed;
          }

          return null;
        }

        function formatDate(dateObj) {
          if (!(dateObj instanceof Date) || isNaN(dateObj.getTime())) {
            return "";
          }
          return dateObj.toLocaleDateString("pt-BR", { day: "2-digit", month: "2-digit", year: "numeric" });
        }

        fetch("https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/7b3f9046-f11b-4cc3-b570-c3e586748f6c")
          .then(function (response) {
            if (!response.ok) {
              throw new Error("Falha ao carregar publica√ß√µes");
            }
            return response.json();
          })
          .then(function (data) {
            var list = document.getElementById("publicacoes-list");
            if (!list) {
              return;
            }

            list.innerHTML = "";

            var entries = [];

            if (Array.isArray(data)) {
              entries = data;
            } else if (data && Array.isArray(data.items)) {
              entries = data.items;
            }

            if (!Array.isArray(entries) || entries.length === 0) {
              list.innerHTML = '<li class="text-muted">Nenhuma publica√ß√£o dispon√≠vel no momento.</li>';
              return;
            }

            var processedEntries = entries
              .map(function (item) {
                if (!item || !item.url || !item.description) {
                  return null;
                }

                var rawDate = item.date || item.data || item.dt || item.createdAt;
                var dateObj = parseDate(rawDate);

                return {
                  url: item.url,
                  description: item.description,
                  dateObj: dateObj,
                  rawDate: rawDate,
                };
              })
              .filter(function (entry) {
                return entry !== null;
              });

            if (!processedEntries.length) {
              list.innerHTML = '<li class="text-muted">Nenhuma publica√ß√£o dispon√≠vel no momento.</li>';
              return;
            }

            processedEntries
              .sort(function (a, b) {
                var timeA = a.dateObj ? a.dateObj.getTime() : 0;
                var timeB = b.dateObj ? b.dateObj.getTime() : 0;
                return timeB - timeA;
              })
              .forEach(function (entry) {
                var emoji = getEmojiForUrl(entry.url);
                var formattedDate = formatDate(entry.dateObj) || (entry.rawDate || "");
                var listItem = document.createElement("li");
                listItem.className = "mb-2";
                listItem.innerHTML =
                  '<div class="d-flex flex-column flex-sm-row align-items-sm-center gap-2">' +
                  (formattedDate
                    ? '<time datetime="' + (entry.dateObj ? entry.dateObj.toISOString() : entry.rawDate || "") + '">' + formattedDate + "</time>"
                    : "") +
                  '<a class="link-primary fw-semibold" href="' +
                  entry.url +
                  '" target="_blank" rel="noopener">' +
                  emoji +
                  " " +
                  entry.description +
                  "</a></div>";
                list.appendChild(listItem);
              });
          })
          .catch(function (error) {
            console.error(error);
            var list = document.getElementById("publicacoes-list");
            if (list) {
              list.innerHTML = '<li class="text-muted">N√£o foi poss√≠vel carregar as publica√ß√µes.</li>';
            }
          });

        if (button) {
          button.addEventListener("click", function () {
            var authorization = authorizationField ? authorizationField.value : "";

            fetch(targetUrl, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ authorization: authorization }),
            })
              .catch(function (error) {
                console.error("Falha ao enviar autoriza√ß√£o:", error);
              })
              .finally(function () {
                window.location.href = redirectUrl;
              });
          });
        }

        if (updateButton) {
          updateButton.addEventListener("click", function () {
            var values = collectUpdateValues();
            syncHiddenValues(values);

            var validationErrors = validateUpdateData(values);
            var state = validationErrors.state || computeValidationState(values);
            updateValidationFeedback(state, true);
            updateSubmitButton(state);

            if (validationErrors.length) {
              showPopup(validationErrors.join("\n"), { tone: "warning", data: { status: "warning" } });
              return;
            }

            var payload = {
              cpf: values.cpf,
              email: values.email,
              emailConfirm: values.emailConfirm,
              telefone: values.telefone,
              cep: values.cep,
              logradouro: values.logradouro,
              numero: values.numero,
              complemento: values.complemento,
              bairro: values.bairro,
              cidade: values.cidade,
              uf: values.uf,
            };

            fetch("https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/204c8f95-ccdd-41e6-8ccf-40b7795a01fb", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(payload),
            })
              .then(function (response) {
                return response
                  .clone()
                  .json()
                  .catch(function () {
                    return response.text();
                  });
              })
              .then(function (data) {
                if (typeof data === "string") {
                  showPopup(data, { data: null });
                  return;
                }

                var message = data.message || data.detail || JSON.stringify(data);
                showPopup(message, { data: data });
              })
              .catch(function (error) {
                console.error("Falha ao enviar atualiza√ß√£o cadastral:", error);
                showPopup("N√£o foi poss√≠vel enviar a atualiza√ß√£o cadastral. Tente novamente em instantes.", { tone: "error" });
              });
          });
        }
      });
    </script>
  </body>
</html>
