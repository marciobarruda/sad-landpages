<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Secretaria de Administra√ß√£o - SAD ‚Äî Sele√ß√£o Simplificada Hospital Veterin√°rio do Recife</title>
    <link
      rel="icon"
      href="https://statics.recife.pe.gov.br/images/dynamics/conecta/icons/favicon.png?w=32&h=32&fit=fill&border=2,transparent,shrink"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
      :root {
        --brand-primary: #0053a4;
        --brand-secondary: #003a73;
        --brand-highlight: #00a3ff;
        --surface: #f4f7fb;
        --surface-strong: #ffffff;
        --border-color: #d0d7e2;
        --text-strong: #1b263b;
        --text-muted: #5b6c8c;
      }

      *, *::before, *::after {
        box-sizing: border-box;
      }

      body {
        font-family: "Public Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: var(--surface);
        color: var(--text-strong);
        min-height: 100vh;
      }

      header.site-header {
        background: url("https://statics.recife.pe.gov.br/images/dynamics/automacao/header.png?w=3000")
          center/cover no-repeat;
        color: #ffffff;
        padding: 3.5rem 0 2.75rem;
      }

      header .lead {
        color: rgba(255, 255, 255, 0.82);
        max-width: 100%;
        font-size: 1rem;
        line-height: 1.65;
        text-align: justify;
      }

      .badge-open {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.95rem;
        font-weight: 600;
        padding: 0.45rem 0.9rem;
        border-radius: 999px;
        background-color: rgba(255, 255, 255, 0.14);
      }

      .user-greeting {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.05rem;
        font-weight: 600;
        margin-bottom: 2rem;
        padding: 1rem 1.5rem;
        border-radius: 1rem;
        background: linear-gradient(135deg, rgba(0, 83, 164, 0.09), rgba(0, 163, 255, 0.12));
        color: var(--text-strong);
        box-shadow: 0 10px 30px rgba(0, 45, 98, 0.08);
      }

      .user-greeting::before {
        content: "üëã";
        font-size: 1.4rem;
      }

      .minhas-inscricoes-grid {
        margin-top: 1rem;
      }

      .minhas-inscricao-card {
        cursor: pointer;
        transition: transform 0.18s ease, box-shadow 0.18s ease;
        border: 1px solid rgba(0, 83, 164, 0.12);
        border-radius: 4px;
      }

      .minhas-inscricao-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(0, 45, 98, 0.12);
      }

      .minhas-inscricao-card.is-loading {
        pointer-events: none;
        opacity: 0.7;
      }

      .minhas-inscricoes-placeholder {
        padding: 1.25rem;
        border-radius: 4px;
        background: rgba(0, 83, 164, 0.05);
        border: 1px dashed rgba(0, 83, 164, 0.2);
        color: var(--text-muted);
      }

      .resumo-inscricao-list dt {
        font-size: 0.75rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        color: var(--text-muted);
      }

      .resumo-inscricao-list dd {
        font-weight: 600;
        color: var(--text-strong);
      }

      .resumo-inscricao-pre {
        background: rgba(0, 83, 164, 0.06);
        border-radius: 0.75rem;
        padding: 0.75rem;
        white-space: pre-wrap;
        font-size: 0.85rem;
        margin-bottom: 0;
      }

      .card {
        border-radius: 4px;
        overflow: hidden;
      }

      .rounded-4 {
        border-radius: 4px !important;
      }

      .collapsible-form {
        border: 1px solid rgba(0, 83, 164, 0.15);
        border-radius: 4px;
        background: rgba(0, 83, 164, 0.05);
        padding: 1rem 1.25rem;
      }

      .collapsible-form summary {
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        list-style: none;
      }

      .collapsible-form summary::marker {
        display: none;
      }

      .collapsible-form summary::-webkit-details-marker {
        display: none;
      }

      .collapsible-form summary::before {
        content: "‚ûï";
        font-size: 0.9rem;
        transition: transform 0.2s ease;
      }

      .collapsible-form[open] summary::before {
        transform: rotate(45deg);
      }

      .collapsible-form .form-label {
        font-weight: 600;
        color: var(--text-strong);
      }

      .collapsible-form .form-text {
        color: var(--text-muted);
      }

      .feedback-modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(27, 38, 59, 0.45);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
        z-index: 1050;
      }

      .feedback-modal-backdrop.active {
        display: flex;
      }

      .feedback-modal {
        background: #ffffff;
        border-radius: 1rem;
        max-width: 420px;
        width: 100%;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.18);
        padding: 1.75rem;
        margin: 0 auto;
      }

      .feedback-modal.feedback-modal--wide {
        max-width: 860px;
      }

      .feedback-modal-title {
        font-weight: 700;
        font-size: 1.1rem;
        margin-bottom: 0.75rem;
        color: var(--text-strong);
      }

      .feedback-modal-message {
        font-size: 0.95rem;
        line-height: 1.6;
        color: var(--text-strong);
        max-height: 60vh;
        overflow-y: auto;
        overflow-x: hidden;
        word-break: break-word;
      }

      .feedback-modal-message > :last-child {
        margin-bottom: 0;
      }

      .feedback-modal button {
        border-radius: 999px;
        padding-inline: 1.5rem;
        font-weight: 600;
      }

      #publicacoes-list time {
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        color: var(--brand-secondary);
        letter-spacing: 0.05em;
      }

      .section-title {
        display: flex;
        align-items: center;
        gap: 0.65rem;
        font-weight: 700;
        font-size: 1.2rem;
        letter-spacing: 0.02em;
        color: var(--text-strong);
      }

      .section-title::before {
        content: "";
        display: inline-block;
        width: 32px;
        height: 3px;
        border-radius: 999px;
        background: var(--brand-highlight);
      }

      .card-programa {
        border: 1px solid rgba(0, 83, 164, 0.08);
        border-radius: 4px;
        background: var(--surface-strong);
        box-shadow: 0 16px 34px rgba(0, 45, 98, 0.08);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        height: 100%;
      }

      .card-programa:hover {
        transform: translateY(-6px);
        box-shadow: 0 20px 38px rgba(0, 45, 98, 0.12);
      }

      .card-programa .card-header {
        border-bottom: 1px solid rgba(0, 83, 164, 0.08);
        background: linear-gradient(180deg, #ffffff 0%, #f5f8fc 100%);
        padding: 1.5rem 1.6rem 1.1rem;
        border-radius: 4px 4px 0 0;
      }

      .card-programa .card-body {
        padding: 1.6rem 1.6rem 1.75rem;
        border-radius: 0 0 4px 4px;
      }

      .card-programa .badge {
        border-radius: 999px;
        font-weight: 600;
        letter-spacing: 0.04em;
      }

      .card-programa ul {
        padding-left: 1.25rem;
        margin-bottom: 1.25rem;
        color: var(--text-muted);
      }

      .card-programa .btn {
        border-radius: 999px;
        padding-inline: 1.6rem;
        font-weight: 600;
        letter-spacing: 0.01em;
      }

      .downloads-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.25rem;
      }

      .download-card {
        border: 1px solid var(--border-color);
        background: var(--surface-strong);
        border-radius: 4px;
        padding: 1.35rem 1.4rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        min-height: 170px;
      }

      .publicacoes-panel,
      .updates-panel {
        border-radius: 4px;
      }

      .download-card strong {
        font-size: 1rem;
        color: var(--text-strong);
      }

      .download-card p {
        margin: 0;
        color: var(--text-muted);
        font-size: 0.95rem;
        line-height: 1.4;
      }

      .download-card a {
        font-weight: 600;
      }

      #publicacoes-list li + li {
        margin-top: 0.75rem;
      }

      .publicacoes-item {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .publicacoes-item-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
      }

      .publicacoes-item-icon {
        display: inline-block;
        width: 1.5rem;
        height: 1.5rem;
        flex-shrink: 0;
        background-repeat: no-repeat;
        background-position: center;
        background-size: contain;
      }

      .publicacoes-item-icon--pdf {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23d32f2f' d='M6 2h7l5 5v15a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z'/%3E%3Cpath fill='%23ef5350' d='M13 2v5h5'/%3E%3Ctext x='12' y='17' text-anchor='middle' font-family='Arial, sans-serif' font-size='7' font-weight='700' fill='%23fff'%3EPDF%3C/text%3E%3C/svg%3E");
      }

      .publicacoes-item-icon--image {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Crect x='3' y='4' width='18' height='16' rx='2' fill='%23215695'/%3E%3Crect x='4.5' y='5.5' width='15' height='13' rx='1.2' fill='%233968c8'/%3E%3Ccircle cx='9' cy='11' r='2.2' fill='%23fff59d'/%3E%3Cpath fill='%23c5cae9' d='M6 18l4.2-4.6 2.7 3.2 2.6-3L18 18z'/%3E%3C/svg%3E");
      }

      .publicacoes-item-icon--generic {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%233f51b5' d='M7 2h7l5 5v15a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z'/%3E%3Cpath fill='%235c6bc0' d='M14 2v5h5'/%3E%3Crect x='8.5' y='12' width='7' height='1.5' rx='.75' fill='%23c5cae9'/%3E%3Crect x='8.5' y='15' width='5' height='1.5' rx='.75' fill='%23c5cae9'/%3E%3C/svg%3E");
      }

      .publicacoes-item time {
        flex-shrink: 0;
      }

      @media (min-width: 576px) {
        .publicacoes-item {
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
        }
      }

      @media (max-width: 575.98px) {
        .publicacoes-item-link {
          align-items: flex-start;
        }
      }

      .updates-panel {
        border-left: 3px solid var(--brand-highlight);
        padding-left: 1.2rem;
        color: var(--text-muted);
      }

      .updates-panel time {
        font-size: 0.85rem;
        color: var(--brand-secondary);
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }

      footer {
        color: var(--text-muted);
        padding: 2.5rem 0 2rem;
        font-size: 0.9rem;
      }

      @media (max-width: 768px) {
        header.site-header {
          padding: 2.5rem 0 2rem;
        }

        .badge-open {
          width: 100%;
          justify-content: center;
        }

        .section-title {
          justify-content: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <input type="hidden" id="authorization" value="{{ $('Code in JavaScript2').item.json.authorization }}" />
    <input type="hidden" id="cpf" value="{{ $json.cpf }}" />
    <input type="hidden" id="email" value="{{ $json.email }}" />
    <input type="hidden" id="telefone" value="{{ $json.telefone }}" />
    <input type="hidden" id="cep" value="{{ $json.cep }}" />
    <input type="hidden" id="logradouro" value="{{ $json.logradouro }}" />
    <input type="hidden" id="numero" value="{{ $json.numero }}" />
    <input type="hidden" id="complemento" value="{{ $json.complemento }}" />
    <input type="hidden" id="bairro" value="{{ $json.bairro }}" />
    <input type="hidden" id="cidade" value="{{ $json.cidade }}" />
    <input type="hidden" id="uf" value="{{ $json.uf }}" />
    <header class="site-header">
      <div class="container">
        <span class="badge-open">Secretaria de Administra√ß√£o - SAD ‚Ä¢ Prefeitura do Recife</span>
        <h1 class="display-6 fw-semibold mt-3">Sele√ß√£o Simplificada Hospital Veterin√°rio do Recife</h1>
        <p class="lead mt-2">
          A SECRETARIA DE ADMINISTRA√á√ÉO e o GABINETE DE PROTE√á√ÉO E DEFESA DOS ANIMAIS, com fundamento no Decreto n¬∫ XXXXX, de XX de XXXXXXXX de 2025,
          tornam p√∫blica a abertura da SELE√á√ÉO P√öBLICA SIMPLIFICADA destinada √† contrata√ß√£o tempor√°ria de 41 (quarenta e um) profissionais, sendo 37
          (trinta e sete) vagas para Analista em Sa√∫de Animal ‚Äì Veterin√°rio, 02 (duas) vagas para T√©cnico em Sa√∫de Animal ‚Äì Radiologia e Imagenologia e
          02 (duas) vagas para Auxiliar em Sa√∫de Animal ‚Äì Auxiliar Veterin√°rio, para atua√ß√£o no Hospital Veterin√°rio do Recife Robson Jos√© Gomes de
          Melo, vinculado ao Gabinete de Prote√ß√£o e Defesa dos Animais, a fim de atender necessidade tempor√°ria de excepcional interesse p√∫blico.
        </p>
      </div>
    </header>

    <main class="container my-5">
      <p class="user-greeting">Ol√°, {{ $json.given_name }}! Que bom ter voc√™ aqui.</p>
      <section class="mb-5">
        <div class="d-flex flex-wrap justify-content-between align-items-start gap-3 mb-4">
          <h2 class="section-title mb-0">Inscri√ß√µes em andamento</h2>
          <div class="text-muted small">
            √öltima atualiza√ß√£o em <strong>outubro de 2025</strong> ‚Ä¢ Hor√°rio oficial do Recife (GMT-3)
          </div>
        </div>

        <div class="row g-4">
          <div class="col-lg-6">
            <article class="card card-programa">
              <div class="card-header">
                <span class="badge text-bg-light text-uppercase text-primary">Sele√ß√£o simplificada</span>
                <h3 class="h5 mt-3 mb-1">Hospital Veterin√°rio do Recife</h3>
                <p class="mb-0 text-muted">Processo seletivo para contrata√ß√£o tempor√°ria ‚Äî Edital SAD N¬∫ 01/2025</p>
              </div>
              <div class="card-body">
                <ul class="mb-0">
                  <li>Per√≠odo de inscri√ß√£o: 10 a 24 de outubro de 2025.</li>
                  <li>Envio de documentos comprobat√≥rios em formato PDF.</li>
                  <li>Etapas conduzidas no Sistema SAD Sele√ß√µes.</li>
                </ul>
                <div class="d-flex flex-wrap gap-2 mt-4">
                  <button class="btn btn-primary px-4 py-2" id="btn-preencher-inscricao" type="button">Preencher formul√°rio de inscri√ß√£o</button>
                </div>
                <div class="mt-4 pt-3 border-top">
                  <h4 class="h6 text-uppercase text-secondary mb-2">Interposi√ß√£o de recursos</h4>
                  <p class="text-muted small mb-3">
                    Informe o n√∫mero da inscri√ß√£o no formato <strong>SSHVR2025XXXXXX</strong>, selecione os anexos pertinentes (at√© 10&nbsp;MB cada) e envie para registro do recurso.
                  </p>
                  <details class="collapsible-form mt-3">
                    <summary>Preparar envio do recurso</summary>
                    <div class="mt-3">
                      <label class="form-label" for="recurso-numero-input">N√∫mero da inscri√ß√£o</label>
                      <input class="form-control" type="text" id="recurso-numero-input" name="numeroInscricao" placeholder="SSHVR2025XXXXXX" autocomplete="off" inputmode="text" pattern="SSHVR2025\d{6}" maxlength="15" required />
                      <div class="form-text">Use o prefixo fixo SSHVR2025 seguido de 6 d√≠gitos num√©ricos.</div>
                    </div>
                    <div class="mt-3">
                      <label class="form-label" for="recurso-arquivo-curricular">Recurso sobre an√°lise curricular</label>
                      <input class="form-control" type="file" id="recurso-arquivo-curricular" name="arquivoRecursoCurricular" accept=".pdf,.png,.jpg,.jpeg,.doc,.docx,.odt" data-tipo="analiseCurricular" data-legenda="Recurso sobre an√°lise curricular" />
                      <div class="form-text">Anexe o documento referente √† etapa de an√°lise curricular (at√© 10&nbsp;MB).</div>
                    </div>
                    <div class="mt-3">
                      <label class="form-label" for="recurso-arquivo-laudo">Recurso de Laudo M√©dico para Pessoas com Defici√™ncia</label>
                      <input class="form-control" type="file" id="recurso-arquivo-laudo" name="arquivoRecursoLaudo" accept=".pdf,.png,.jpg,.jpeg,.doc,.docx,.odt" data-tipo="laudoMedicoPcd" data-legenda="Recurso de Laudo M√©dico para Pessoas com Defici√™ncia" />
                      <div class="form-text">Utilize este campo para anexar o laudo m√©dico PcD (at√© 10&nbsp;MB).</div>
                    </div>
                    <div class="mt-3">
                      <label class="form-label" for="recurso-arquivo-autodeclaracao">Recurso de Autodeclara√ß√£o ‚Äî Candidatos Negros</label>
                      <input class="form-control" type="file" id="recurso-arquivo-autodeclaracao" name="arquivoRecursoAutodeclaracao" accept=".pdf,.png,.jpg,.jpeg,.doc,.docx,.odt" data-tipo="autodeclaracaoNegros" data-legenda="Recurso de Autodeclara√ß√£o ‚Äî Candidatos Negros" />
                      <div class="form-text">Anexe o documento de autodeclara√ß√£o para candidatos negros (at√© 10&nbsp;MB).</div>
                    </div>
                    <div class="mt-3 text-muted small">Selecione apenas os arquivos necess√°rios para o seu recurso. Pelo menos um anexo deve ser informado.</div>
                  </details>
                  <button class="btn btn-outline-primary mt-3" id="btn-enviar-recurso" type="button" data-endpoint="https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/d2d44182-1ae3-47db-ab77-4ece9878e6dd" disabled>Enviar recurso</button>
                </div>
              </div>
            </article>
          </div>

          <div class="col-lg-6 d-flex flex-column gap-4">
            <section class="publicacoes-panel bg-white rounded-4 border shadow-sm p-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="h6 text-uppercase text-secondary mb-0">Publica√ß√µes</h3>
                <span class="badge text-bg-light text-primary">Atualizado automaticamente</span>
              </div>
              <ul class="list-unstyled mb-0" id="publicacoes-list">
                <li class="text-muted">Carregando publica√ß√µes...</li>
              </ul>
            </section>
            <article class="card card-programa">
              <div class="card-header">
                <span class="badge text-bg-light text-uppercase text-primary">Atualiza√ß√£o cadastral</span>
                <h3 class="h5 mt-3 mb-1">Hospital Veterin√°rio ‚Äî Cadastro de Reservas</h3>
                <p class="mb-0 text-muted">Atualize exclusivamente e-mail, telefone e endere√ßo para manter o cadastro atualizado.</p>
              </div>
              <div class="card-body">
                <ul class="mb-0">
                  <li>Revise e confirme os dados antes de enviar a atualiza√ß√£o.</li>
                  <li>As informa√ß√µes ser√£o atualizadas em seu cadastro.</li>
                </ul>
                <details class="collapsible-form mt-3">
                  <summary>Atualizar dados de contato</summary>
                  <div class="mt-3">
                    <label class="form-label" for="email-input">E-mail</label>
                    <input class="form-control" type="email" id="email-input" name="email" value="{{ $json.email }}" placeholder="nome@exemplo.com" autocomplete="email" required />
                    <div class="form-text">Informe o endere√ßo eletr√¥nico que receber√° os comunicados oficiais.</div>
                  </div>
                  <div class="mt-3">
                    <label class="form-label" for="email-confirm-input">Confirmar e-mail</label>
                    <input class="form-control" type="email" id="email-confirm-input" name="emailConfirm" value="" placeholder="Confirme seu e-mail" autocomplete="email" required />
                    <div class="form-text">Digite novamente para validar o endere√ßo informado.</div>
                  </div>
                  <div class="mt-3">
                    <label class="form-label" for="telefone-input">Telefone</label>
                    <input class="form-control" type="tel" id="telefone-input" name="telefone" value="{{ $json.telefone }}" placeholder="DDD + n√∫mero" inputmode="numeric" maxlength="11" required />
                    <div class="form-text">Informe 11 d√≠gitos num√©ricos (ex.: 81999999999) para contato preferencial.</div>
                  </div>
                  <div class="mt-3">
                    <label class="form-label" for="cep-input">CEP</label>
                    <input class="form-control" type="text" id="cep-input" name="cep" value="{{ $json.cep }}" placeholder="00000000" inputmode="numeric" maxlength="8" required />
                    <div class="form-text">Informe o CEP com 8 d√≠gitos.</div>
                  </div>
                  <div class="row g-3 mt-3">
                    <div class="col-md-8">
                      <label class="form-label" for="logradouro-input">Logradouro</label>
                      <input class="form-control" type="text" id="logradouro-input" name="logradouro" value="{{ $json.logradouro }}" placeholder="Rua, avenida, travessa..." required />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label" for="numero-input">N√∫mero</label>
                      <input class="form-control" type="text" id="numero-input" name="numero" value="{{ $json.numero }}" placeholder="000" required />
                    </div>
                  </div>
                  <div class="mt-3">
                    <label class="form-label" for="complemento-input">Complemento</label>
                    <input class="form-control" type="text" id="complemento-input" name="complemento" value="{{ $json.complemento }}" placeholder="Apartamento, bloco, refer√™ncia" required />
                  </div>
                  <div class="row g-3 mt-3">
                    <div class="col-md-6">
                      <label class="form-label" for="bairro-input">Bairro</label>
                      <input class="form-control" type="text" id="bairro-input" name="bairro" value="{{ $json.bairro }}" placeholder="Nome do bairro" required />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label" for="cidade-input">Cidade</label>
                      <input class="form-control" type="text" id="cidade-input" name="cidade" value="{{ $json.cidade }}" placeholder="Munic√≠pio" required />
                    </div>
                    <div class="col-md-2">
                      <label class="form-label" for="uf-input">UF</label>
                      <input class="form-control text-uppercase is-invalid" type="text" id="uf-input" name="uf" value="" placeholder="UF" maxlength="2" required />
                    </div>
                  </div>
                </details>
                <button class="btn btn-outline-primary mt-3" id="btn-atualizar-cadastro" type="button" disabled>Enviar atualiza√ß√£o de contato</button>
              </div>
            </article>
          </div>
        </div>
      </section>

      <section class="mb-5" id="minhas-inscricoes-section">
        <div class="d-flex flex-wrap justify-content-between align-items-start gap-3 mb-3">
          <h2 class="section-title mb-0">Minhas inscri√ß√µes</h2>
          <p class="text-muted small mb-0">Selecione uma inscri√ß√£o para visualizar o resumo cadastral.</p>
        </div>
        <div id="minhas-inscricoes-loading" class="minhas-inscricoes-placeholder">
          Carregando inscri√ß√µes vinculadas ao CPF informado...
        </div>
        <div id="minhas-inscricoes-empty" class="minhas-inscricoes-placeholder d-none">
          Nenhuma inscri√ß√£o encontrada para o CPF informado.
        </div>
        <div
          id="minhas-inscricoes-cards"
          class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 minhas-inscricoes-grid d-none"
        ></div>
      </section>

      <section class="mb-5">
        <h2 class="section-title mb-3">Documentos obrigat√≥rios e modelos</h2>
        <p class="text-muted mb-4">
          Utilize os modelos oficiais disponibilizados abaixo. Todos os anexos devem ser assinados, digitalizados em alta
          resolu√ß√£o e enviados em formato PDF conforme orienta√ß√µes do edital.
        </p>

        <div class="downloads-grid">
          <article class="download-card">
            <strong>Modelo de Laudo M√©dico para Pessoas com Defici√™ncia</strong>
            <p>Documento comprobat√≥rio exigido para candidatos que solicitam reserva de vagas PcD.</p>
            <a
              class="link-primary"
              href="FORM%20MODELO%20DE%20LAUDO%20M√âDICO%20PARA%20PESSOAS%20COM%20DEFICI√äNCIA.pdf"
              download="FORM MODELO DE LAUDO M√âDICO PARA PESSOAS COM DEFICI√äNCIA.pdf"
              data-open-external="true"
              data-force-download="true"
              data-preview-label="Modelo de Laudo M√©dico para Pessoas com Defici√™ncia"
              >Baixar modelo em PDF</a
            >
          </article>

          <article class="download-card">
            <strong>Termo de Autodeclara√ß√£o ‚Äî Candidatos Negros (Preto e Pardo)</strong>
            <p>Assinatura obrigat√≥ria para candidatos que optarem pela reserva de vagas para pessoas negras.</p>
            <a
              class="link-primary"
              href="FORM%20TERMO%20DE%20AUTODECLARA√á√ÉO%20DE%20CANDIDATOS%20NEGROS%20(PRETO%20E%20PARDO).pdf"
              download="FORM TERMO DE AUTODECLARA√á√ÉO DE CANDIDATOS NEGROS (PRETO E PARDO).pdf"
              data-open-external="true"
              data-force-download="true"
              data-preview-label="Termo de Autodeclara√ß√£o ‚Äî Candidatos Negros"
              >Baixar termo em PDF</a
            >
          </article>

          <article class="download-card">
            <strong>Termo de Autodeclara√ß√£o de Identidade Ind√≠gena (TADII)</strong>
            <p>Documento exigido para autodeclara√ß√£o de pertencimento a povos ind√≠genas.</p>
            <a
              class="link-primary"
              href="FORM%20TERMO%20DE%20AUTODECLARA√á√ÉO%20DE%20IDENTIDADE%20IND√çGENA%20-%20TADII.pdf"
              download="FORM TERMO DE AUTODECLARA√á√ÉO DE IDENTIDADE IND√çGENA - TADII.pdf"
              data-open-external="true"
              data-force-download="true"
              data-preview-label="Termo de Autodeclara√ß√£o de Identidade Ind√≠gena"
              >Baixar termo em PDF</a
            >
          </article>
        </div>
      </section>

      <section class="row g-4 align-items-start mb-5">
        <div class="col-lg-7">
          <h2 class="section-title mb-3">Orienta√ß√µes para inscri√ß√£o</h2>
          <ol class="list-group list-group-numbered shadow-sm">
            <li class="list-group-item">
              Leia atentamente o edital e verifique os requisitos de participa√ß√£o, prazos e crit√©rios de classifica√ß√£o.
            </li>
            <li class="list-group-item">
              Separe toda a documenta√ß√£o obrigat√≥ria em formato PDF, com tamanho m√°ximo de 10&nbsp;MB por arquivo.
            </li>
            <li class="list-group-item">
              Utilize o formul√°rio eletr√¥nico para preencher seus dados pessoais, profissionais e anexar a documenta√ß√£o.
            </li>
            <li class="list-group-item">
              Ap√≥s o envio, acompanhe o e-mail cadastrado e o portal oficial para publica√ß√µes de listas e comunicados.
            </li>
          </ol>
        </div>
        <div class="col-lg-5">
          <div class="updates-panel bg-white rounded-4 p-4 shadow-sm">
            <h3 class="h6 text-uppercase text-secondary fw-bold mb-3">Orienta√ß√µes adicionais</h3>
            <p class="mb-2">Mantenha seus dados de contato atualizados para receber comunicados oficiais sobre o andamento do certame.</p>
            <p class="mb-0">As publica√ß√µes com listas, retifica√ß√µes e convoca√ß√µes ser√£o disponibilizadas automaticamente na √°rea "Publica√ß√µes" acima.</p>
          </div>
        </div>
      </section>

      <section class="mb-5">
        <h2 class="section-title mb-3">Canais de suporte</h2>
        <div class="row g-3">
          <div class="col-md-4">
            <div class="p-4 bg-white rounded-4 border shadow-sm h-100">
              <h3 class="h6 text-uppercase text-secondary">Atendimento eletr√¥nico</h3>
              <p class="mb-1 fw-semibold">sad.selecao@recife.pe.gov.br</p>
              <p class="mb-0 text-muted">Resposta em at√© 2 dias √∫teis.</p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="bg-white border-top">
      <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between gap-2">
        <span>Secretaria de Administra√ß√£o - SAD ‚Äî Prefeitura do Recife</span>
        <span class="text-muted">¬© 2025 ‚Ä¢ Coordenadoria de Processos Seletivos</span>
      </div>
    </footer>
    <div class="feedback-modal-backdrop" id="feedback-modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="feedback-modal">
        <h4 class="feedback-modal-title" id="feedback-modal-title"></h4>
        <div class="feedback-modal-message" id="feedback-modal-message"></div>
        <button type="button" class="btn btn-primary mt-4" id="feedback-modal-close">Fechar</button>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var button = document.getElementById("btn-preencher-inscricao");
        var authorizationField = document.getElementById("authorization");
        var targetUrl = "https://secti.recife.pe.gov.br/47e510d9-7e40-4191-a7b9-8993e2a05eb7";
        var redirectUrl = "https://secti.recife.pe.gov.br/47e510d9-7e40-4191-a7b9-8993e2a05eb7";
        var updateButton = document.getElementById("btn-atualizar-cadastro");
        var emailInput = document.getElementById("email-input");
        var emailConfirmInput = document.getElementById("email-confirm-input");
        var telefoneInput = document.getElementById("telefone-input");
        var cepInput = document.getElementById("cep-input");
        var logradouroInput = document.getElementById("logradouro-input");
        var numeroInput = document.getElementById("numero-input");
        var complementoInput = document.getElementById("complemento-input");
        var bairroInput = document.getElementById("bairro-input");
        var cidadeInput = document.getElementById("cidade-input");
        var ufInput = document.getElementById("uf-input");
        var emailHidden = document.getElementById("email");
        var telefoneHidden = document.getElementById("telefone");
        var cepHidden = document.getElementById("cep");
        var logradouroHidden = document.getElementById("logradouro");
        var numeroHidden = document.getElementById("numero");
        var complementoHidden = document.getElementById("complemento");
        var bairroHidden = document.getElementById("bairro");
        var cidadeHidden = document.getElementById("cidade");
        var ufHidden = document.getElementById("uf");
        var recursoButton = document.getElementById("btn-enviar-recurso");
        var recursoNumeroInput = document.getElementById("recurso-numero-input");
        var recursoArquivoInputs = [
          { input: document.getElementById("recurso-arquivo-curricular"), tipo: "analiseCurricular" },
          { input: document.getElementById("recurso-arquivo-laudo"), tipo: "laudoMedicoPcd" },
          { input: document.getElementById("recurso-arquivo-autodeclaracao"), tipo: "autodeclaracaoNegros" },
        ];
        var recursoEndpoint = recursoButton ? recursoButton.getAttribute("data-endpoint") : "";
        var recursoMaxFileSize = 10 * 1024 * 1024;
        var recursoPrefix = "SSHVR2025";
        var recursoDigits = 6;
        var recursoPattern = /^SSHVR2025\d{6}$/;
        var modalBackdrop = document.getElementById("feedback-modal");
        var modalTitle = document.getElementById("feedback-modal-title");
        var modalMessage = document.getElementById("feedback-modal-message");
        var modalClose = document.getElementById("feedback-modal-close");
        var modalContainer = modalBackdrop ? modalBackdrop.querySelector(".feedback-modal") : null;
        var popupCloseHandler = null;
        var lastCepConsulted = "";
        var minhasInscricoesSection = document.getElementById("minhas-inscricoes-section");
        var minhasInscricoesList = document.getElementById("minhas-inscricoes-cards");
        var minhasInscricoesLoading = document.getElementById("minhas-inscricoes-loading");
        var minhasInscricoesEmpty = document.getElementById("minhas-inscricoes-empty");
        var inscricoesListEndpoint = "https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/d9a52f68-88ee-44af-b8e5-335131a9ba31";
        var inscricoesResumoEndpoint = "https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/consultar-sesuite";
        var minhasInscricoesEmptyDefault = minhasInscricoesEmpty ? minhasInscricoesEmpty.textContent.trim() : "";
        var minhasInscricoesLoadingDefault = minhasInscricoesLoading ? minhasInscricoesLoading.textContent.trim() : "";
        function getPublicationIcon(mimeType, extension, url) {
          var normalizedExtension = "";
          var normalizedMime = "";

          if (mimeType) {
            normalizedMime = String(mimeType).toLowerCase().trim();
          }

          if (extension) {
            normalizedExtension = String(extension).toLowerCase().trim();
          }

          if (normalizedExtension.startsWith(".")) {
            normalizedExtension = normalizedExtension.slice(1);
          }

          if (!normalizedExtension && url) {
            var guessed = String(url).split("?")[0].split("#")[0];
            var parts = guessed.split(".");
            normalizedExtension = parts.length > 1 ? parts.pop().toLowerCase() : "";
          }

          if (normalizedMime) {
            if (normalizedMime === "application/pdf" || normalizedMime === "application/x-pdf") {
              return "pdf";
            }

            if (normalizedMime.indexOf("image/") === 0) {
              return "image";
            }
          }

          if (normalizedExtension === "pdf") {
            return "pdf";
          }

          var imageExtensions = {
            jpg: true,
            jpeg: true,
            png: true,
            gif: true,
            bmp: true,
            svg: true,
            webp: true,
            tif: true,
            tiff: true,
            heic: true,
          };

          if (normalizedExtension && imageExtensions[normalizedExtension]) {
            return "image";
          }

          return "generic";
        }

        function sanitizeDigits(value) {
          return (value || "").replace(/\D/g, "");
        }

        function normalizeInscricao(value) {
          var raw = (value || "").toString().toUpperCase();
          var digitsPart;

          if (raw.startsWith(recursoPrefix)) {
            digitsPart = raw.slice(recursoPrefix.length).replace(/\D/g, "");
          } else {
            digitsPart = raw.replace(/\D/g, "");
          }

          return recursoPrefix + digitsPart.slice(0, recursoDigits);
        }

        function determineToneFromContent(message, data) {
          var normalizedMessage = (message || "").toLowerCase();
          var statusField = "";

          if (data && typeof data === "object" && !Array.isArray(data)) {
            if (data.status) {
              statusField = String(data.status).toLowerCase();
            } else if (data.result) {
              statusField = String(data.result).toLowerCase();
            } else if (data.type) {
              statusField = String(data.type).toLowerCase();
            } else if (data.title) {
              statusField = String(data.title).toLowerCase();
            }
          }

          if (statusField.includes("sucesso") || statusField === "success" || statusField === "ok") {
            return "success";
          }
          if (statusField.includes("erro") || statusField.includes("error") || statusField.includes("falha") || statusField.includes("fail")) {
            return "error";
          }

          if (normalizedMessage.includes("sucesso") || normalizedMessage.includes("atualiz")) {
            return "success";
          }
          if (
            normalizedMessage.includes("erro") ||
            normalizedMessage.includes("falha") ||
            normalizedMessage.includes("inv√°lid") ||
            normalizedMessage.includes("n√£o foi poss√≠vel")
          ) {
            return "error";
          }
          if (
            normalizedMessage.includes("aten√ß√£o") ||
            normalizedMessage.includes("aguarde") ||
            normalizedMessage.includes("verifique") ||
            normalizedMessage.includes("pendente")
          ) {
            return "warning";
          }
          return null;
        }

        function applyModalVariant(variant) {
          if (!modalContainer) {
            return;
          }

          modalContainer.classList.remove("feedback-modal--wide");

          if (!variant) {
            return;
          }

          if (variant === "wide") {
            modalContainer.classList.add("feedback-modal--wide");
          }
        }

        function showPopup(message, options) {
          var msg = message === undefined || message === null ? "" : String(message);
          var toneHint = options && options.tone;
          var tone = toneHint || determineToneFromContent(msg, options && options.data);
          var title;

          applyModalVariant(options && options.size);

          if (options && options.title) {
            title = String(options.title);
          } else {
            switch (tone) {
              case "success":
                title = "‚úÖ Sucesso";
                break;
              case "error":
                title = "‚ùå Erro";
                break;
              case "warning":
                title = "‚ö†Ô∏è Aten√ß√£o";
                break;
              default:
                title = "‚ÑπÔ∏è Informativo";
                break;
            }
          }

          if (modalTitle) {
            modalTitle.textContent = title;
          }
          if (modalMessage) {
            var trimmedMessage = msg.trim();
            var complementoAviso = "Atualize tamb√©m as suas informa√ß√µes cadastrais no ConectaRecife.";
            var appendReminder = options && Object.prototype.hasOwnProperty.call(options, "appendReminder")
              ? options.appendReminder !== false
              : true;

            if (options && options.htmlContent) {
              var htmlContent = String(options.htmlContent || "");
              modalMessage.innerHTML = appendReminder
                ? htmlContent + '<p class="mt-3 small text-muted">' + complementoAviso + "</p>"
                : htmlContent;
            } else {
              var finalMessage = trimmedMessage ? trimmedMessage + " " + complementoAviso : complementoAviso;
              modalMessage.textContent = finalMessage;
            }
          }
          if (modalBackdrop) {
            modalBackdrop.classList.add("active");
            modalBackdrop.setAttribute("aria-hidden", "false");
          }
          if (modalClose) {
            modalClose.focus();
          }
          popupCloseHandler = options && typeof options.onClose === "function" ? options.onClose : null;
        }

        function hidePopup() {
          if (modalBackdrop) {
            modalBackdrop.classList.remove("active");
            modalBackdrop.setAttribute("aria-hidden", "true");
          }
          popupCloseHandler = null;
        }

        if (modalClose) {
          modalClose.addEventListener("click", function () {
            if (typeof popupCloseHandler === "function") {
              var handler = popupCloseHandler;
              popupCloseHandler = null;
              handler();
            }
            hidePopup();
          });
        }
        if (modalBackdrop) {
          modalBackdrop.addEventListener("click", function (event) {
            if (event.target === modalBackdrop) {
              hidePopup();
            }
          });
        }
        document.addEventListener("keydown", function (event) {
          if (event.key === "Escape") {
            hidePopup();
          }
        });

        function escapeHtml(value) {
          return String(value)
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#39;");
        }

        function formatResumoLabel(label) {
          return String(label || "")
            .replace(/([a-z])([A-Z])/g, "$1 $2")
            .replace(/[_-]+/g, " ")
            .trim()
            .split(/\s+/)
            .map(function (word) {
              return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
            })
            .join(" ");
        }

        function isPlainObject(value) {
          return Object.prototype.toString.call(value) === "[object Object]";
        }

        function buildDefinitionListFromObject(obj) {
          if (!isPlainObject(obj)) {
            return "";
          }

          var keys = Object.keys(obj);
          if (!keys.length) {
            return '<p class="mb-0 text-muted">Nenhum dado retornado.</p>';
          }

          var rows = keys
            .map(function (key) {
              var value = obj[key];
              if (value === undefined || value === null || value === "") {
                return "";
              }

              var label = formatResumoLabel(key);
              var valueHtml;

              if (Array.isArray(value) || isPlainObject(value)) {
                valueHtml = '<pre class="resumo-inscricao-pre">' + escapeHtml(JSON.stringify(value, null, 2)) + "</pre>";
              } else {
                valueHtml = '<span>' + escapeHtml(value) + "</span>";
              }

              return (
                '<dt class="col-sm-4">' +
                escapeHtml(label) +
                '</dt><dd class="col-sm-8">' +
                valueHtml +
                "</dd>"
              );
            })
            .filter(function (row) {
              return !!row;
            })
            .join("");

          if (!rows) {
            return '<p class="mb-0 text-muted">Nenhum dado retornado.</p>';
          }

          return '<dl class="row g-2 resumo-inscricao-list mb-0">' + rows + "</dl>";
        }

        function buildResumoHtml(data, numero) {
          var header = numero ? '<h5 class="fw-semibold mb-3">Inscri√ß√£o ' + escapeHtml(numero) + "</h5>" : "";

          if (data === undefined || data === null) {
            return header + '<p class="mb-0 text-muted">Nenhuma informa√ß√£o retornada pelo servi√ßo.</p>';
          }

          if (Array.isArray(data)) {
            if (!data.length) {
              return header + '<p class="mb-0 text-muted">Nenhum registro retornado para esta inscri√ß√£o.</p>';
            }

            var blocks = data
              .map(function (item, index) {
                var titulo = data.length > 1 ? '<h6 class="fw-semibold mt-3 mb-2">Registro ' + (index + 1) + "</h6>" : "";
                if (isPlainObject(item)) {
                  return titulo + buildDefinitionListFromObject(item);
                }
                return titulo + '<pre class="resumo-inscricao-pre">' + escapeHtml(JSON.stringify(item, null, 2)) + "</pre>";
              })
              .join("");

            return header + blocks;
          }

          if (isPlainObject(data)) {
            return header + buildDefinitionListFromObject(data);
          }

          return header + '<p class="mb-0">' + escapeHtml(String(data)) + "</p>";
        }

        function setMinhasInscricoesState(state) {
          if (minhasInscricoesLoading) {
            if (!minhasInscricoesLoadingDefault) {
              minhasInscricoesLoadingDefault = "Carregando inscri√ß√µes vinculadas ao CPF informado...";
            }
            minhasInscricoesLoading.classList.toggle("d-none", state !== "loading");
          }
          if (minhasInscricoesEmpty) {
            if (!minhasInscricoesEmptyDefault) {
              minhasInscricoesEmptyDefault = "Nenhuma inscri√ß√£o encontrada para o CPF informado.";
            }
            minhasInscricoesEmpty.classList.toggle("d-none", state !== "empty");
          }
          if (minhasInscricoesList) {
            minhasInscricoesList.classList.toggle("d-none", state !== "ready");
          }
          if (minhasInscricoesSection) {
            minhasInscricoesSection.classList.toggle("d-none", state === "hidden");
          }
        }

        function normalizeMinhasInscricoes(data) {
          if (!data) {
            return [];
          }

          var entries;
          if (Array.isArray(data)) {
            entries = data;
          } else if (Array.isArray(data.inscricoes)) {
            entries = data.inscricoes;
          } else if (Array.isArray(data.items)) {
            entries = data.items;
          } else if (Array.isArray(data.result)) {
            entries = data.result;
          } else if (Array.isArray(data.data)) {
            entries = data.data;
          } else if (isPlainObject(data)) {
            entries = [data];
          } else {
            entries = [];
          }

          return entries
            .map(function (item) {
              if (!item) {
                return null;
              }

              var numero =
                item.numeroInscricao || item.inscricao || item.numero || item.codigo || item.id || item.registrationNumber;
              if (numero) {
                numero = String(numero).trim();
              }

              if (!numero) {
                return null;
              }

              var cargo =
                item.cargo ||
                item.descricaoCargo ||
                item.funcao ||
                item.descricao ||
                item.titulo ||
                item.nomeCargo ||
                "Cargo n√£o informado";

              cargo = cargo ? String(cargo).trim() : "Cargo n√£o informado";

              var especialidade =
                item.especialidade ||
                item.areaEspecialidade ||
                item.area ||
                item.funcaoDetalhada ||
                item.disciplina ||
                "";

              especialidade = especialidade ? String(especialidade).trim() : "";

              return {
                numero: numero,
                cargo: cargo,
                especialidade: especialidade,
              };
            })
            .filter(function (entry) {
              return entry !== null;
            });
        }

        function renderMinhasInscricoes(entries) {
          if (!minhasInscricoesList) {
            return;
          }

          minhasInscricoesList.innerHTML = "";

          entries.forEach(function (entry) {
            var col = document.createElement("div");
            col.className = "col";

            var card = document.createElement("article");
            card.className = "card h-100 shadow-sm minhas-inscricao-card";
            card.setAttribute("role", "button");
            card.setAttribute("tabindex", "0");
            var ariaLabel = "Consultar detalhes da inscri√ß√£o " + entry.numero;
            if (entry.cargo) {
              ariaLabel += ", " + entry.cargo;
            }
            if (entry.especialidade) {
              ariaLabel += ", especialidade " + entry.especialidade;
            }
            card.setAttribute("aria-label", ariaLabel);

            var cardBody = document.createElement("div");
            cardBody.className = "card-body";

            var title = document.createElement("h3");
            title.className = "h6 fw-semibold text-primary mb-1";
            title.textContent = entry.numero;

            var cargoEl = document.createElement("p");
            cargoEl.className = "text-muted mb-1";
            cargoEl.textContent = entry.cargo || "Cargo n√£o informado";

            cardBody.appendChild(title);
            cardBody.appendChild(cargoEl);

            var especialidadeEl = document.createElement("p");
            especialidadeEl.className = "text-muted small mb-0";
            especialidadeEl.textContent = entry.especialidade ? entry.especialidade : "Especialidade n√£o informada";
            cardBody.appendChild(especialidadeEl);
            card.appendChild(cardBody);

            card.addEventListener("click", function () {
              consultarResumoInscricao(entry.numero, card);
            });

            card.addEventListener("keydown", function (event) {
              if (event.key === "Enter" || event.key === " ") {
                event.preventDefault();
                consultarResumoInscricao(entry.numero, card);
              }
            });

            col.appendChild(card);
            minhasInscricoesList.appendChild(col);
          });

          setMinhasInscricoesState(entries.length ? "ready" : "empty");
        }

        function consultarResumoInscricao(numero, sourceElement) {
          if (!numero) {
            showPopup("N√£o foi poss√≠vel identificar o n√∫mero da inscri√ß√£o selecionada.", { tone: "warning" });
            return;
          }

          if (sourceElement) {
            sourceElement.classList.add("is-loading");
            sourceElement.setAttribute("aria-busy", "true");
          }

          var cpfField = document.getElementById("cpf");
          var cpfValue = cpfField ? cpfField.value : "";
          var payload = {
            numeroInscricao: numero,
            inscricao: numero,
            numero: numero,
          };

          if (cpfValue) {
            payload.cpf = cpfValue;
          }

          fetch(inscricoesResumoEndpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          })
            .then(function (response) {
              return response
                .clone()
                .json()
                .catch(function () {
                  return response.text();
                })
                .then(function (parsed) {
                  return { parsed: parsed, ok: response.ok, status: response.status };
                });
            })
            .then(function (result) {
              var data = result.parsed;
              var isSuccess = !!result.ok;

              if (typeof data === "string") {
                var toneFromMessage = determineToneFromContent(data, null);
                if (!toneFromMessage && isSuccess) {
                  toneFromMessage = "success";
                }
                showPopup(data, { tone: toneFromMessage || (isSuccess ? "success" : "error") });
                return;
              }

              var tone = determineToneFromContent("", data);
              if (!tone && isSuccess) {
                tone = "success";
              }

              var htmlContent = buildResumoHtml(data, numero);
              showPopup("", {
                data: data,
                tone: tone,
                htmlContent: htmlContent,
                appendReminder: false,
                title: "üìÑ Resumo da inscri√ß√£o",
                size: "wide",
              });
            })
            .catch(function (error) {
              console.error("Falha ao consultar inscri√ß√£o:", error);
              showPopup("N√£o foi poss√≠vel consultar os detalhes da inscri√ß√£o no momento.", { tone: "error" });
            })
            .finally(function () {
              if (sourceElement) {
                sourceElement.classList.remove("is-loading");
                sourceElement.removeAttribute("aria-busy");
              }
            });
        }

        function carregarMinhasInscricoes() {
          if (!minhasInscricoesList) {
            return;
          }

          if (minhasInscricoesLoading && minhasInscricoesLoadingDefault) {
            minhasInscricoesLoading.textContent = minhasInscricoesLoadingDefault;
          }
          if (minhasInscricoesEmpty && minhasInscricoesEmptyDefault) {
            minhasInscricoesEmpty.textContent = minhasInscricoesEmptyDefault;
          }

          var cpfField = document.getElementById("cpf");
          var cpfValue = cpfField ? cpfField.value : "";

          if (!cpfValue) {
            if (minhasInscricoesEmpty) {
              minhasInscricoesEmpty.textContent = "N√£o foi poss√≠vel localizar o CPF para consultar as inscri√ß√µes.";
            }
            setMinhasInscricoesState("empty");
            return;
          }

          setMinhasInscricoesState("loading");

          fetch(inscricoesListEndpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ cpf: cpfValue }),
          })
            .then(function (response) {
              if (!response.ok) {
                throw new Error("Resposta inv√°lida ao buscar inscri√ß√µes");
              }
              return response.json();
            })
            .then(function (data) {
              var entries = normalizeMinhasInscricoes(data);

              if (!entries.length) {
                setMinhasInscricoesState("empty");
                return;
              }

              renderMinhasInscricoes(entries);
            })
            .catch(function (error) {
              console.error("Falha ao carregar inscri√ß√µes:", error);
              if (minhasInscricoesEmpty) {
                minhasInscricoesEmpty.textContent = "N√£o foi poss√≠vel carregar suas inscri√ß√µes. Tente novamente mais tarde.";
              }
              setMinhasInscricoesState("empty");
            });
        }

        function cleanupUpdateForm() {
          [
            emailInput,
            emailConfirmInput,
            telefoneInput,
            cepInput,
            logradouroInput,
            numeroInput,
            complementoInput,
            bairroInput,
            cidadeInput,
            ufInput,
          ].forEach(function (input) {
            if (input) {
              input.value = "";
              input.classList.remove("is-invalid");
            }
          });

          lastCepConsulted = "";
          handleInputChange();
        }

        function cleanupRecursoForm() {
          if (recursoNumeroInput) {
            recursoNumeroInput.value = "";
            recursoNumeroInput.classList.remove("is-invalid");
            delete recursoNumeroInput.dataset.touched;
          }
          recursoArquivoInputs.forEach(function (entry) {
            if (entry.input) {
              entry.input.value = "";
              entry.input.classList.remove("is-invalid");
              delete entry.input.dataset.touched;
            }
          });
          atualizarFeedbackRecurso(false);
        }

        function collectUpdateValues() {
          var cpfField = document.getElementById("cpf");
          var emailValue = emailInput ? emailInput.value.trim().toLowerCase() : "";
          var emailConfirmValue = emailConfirmInput ? emailConfirmInput.value.trim().toLowerCase() : "";
          var telefoneValue = telefoneInput ? sanitizeDigits(telefoneInput.value) : "";
          var cepValue = cepInput ? sanitizeDigits(cepInput.value) : "";
          var logradouroValue = logradouroInput ? logradouroInput.value.trim().toUpperCase() : "";
          var numeroValue = numeroInput ? numeroInput.value.trim().toUpperCase() : "";
          var complementoValue = complementoInput ? complementoInput.value.trim().toUpperCase() : "";
          var bairroValue = bairroInput ? bairroInput.value.trim().toUpperCase() : "";
          var cidadeValue = cidadeInput ? cidadeInput.value.trim().toUpperCase() : "";
          var ufValue = ufInput ? String(ufInput.value || "").replace(/[^a-zA-Z]/g, "").slice(0, 2).toUpperCase() : "";

          if (emailInput && emailInput.value !== emailValue) {
            emailInput.value = emailValue;
          }
          if (emailConfirmInput && emailConfirmInput.value !== emailConfirmValue) {
            emailConfirmInput.value = emailConfirmValue;
          }
          if (telefoneInput && telefoneInput.value !== telefoneValue) {
            telefoneInput.value = telefoneValue;
          }
          if (cepInput && cepInput.value !== cepValue) {
            cepInput.value = cepValue;
          }
          if (logradouroInput && logradouroInput.value !== logradouroValue) {
            logradouroInput.value = logradouroValue;
          }
          if (numeroInput && numeroInput.value !== numeroValue) {
            numeroInput.value = numeroValue;
          }
          if (complementoInput && complementoInput.value !== complementoValue) {
            complementoInput.value = complementoValue;
          }
          if (bairroInput && bairroInput.value !== bairroValue) {
            bairroInput.value = bairroValue;
          }
          if (cidadeInput && cidadeInput.value !== cidadeValue) {
            cidadeInput.value = cidadeValue;
          }
          if (ufInput && ufInput.value !== ufValue) {
            ufInput.value = ufValue;
          }

          return {
            cpf: cpfField ? cpfField.value : "",
            email: emailValue,
            emailConfirm: emailConfirmValue,
            telefone: telefoneValue,
            cep: cepValue,
            logradouro: logradouroValue,
            numero: numeroValue,
            complemento: complementoValue,
            bairro: bairroValue,
            cidade: cidadeValue,
            uf: ufValue,
          };
        }

        function syncHiddenValues(values) {
          if (!values) {
            return;
          }
          if (emailHidden) {
            emailHidden.value = values.email || "";
          }
          if (telefoneHidden) {
            telefoneHidden.value = values.telefone || "";
          }
          if (cepHidden) {
            cepHidden.value = values.cep || "";
          }
          if (logradouroHidden) {
            logradouroHidden.value = values.logradouro || "";
          }
          if (numeroHidden) {
            numeroHidden.value = values.numero || "";
          }
          if (complementoHidden) {
            complementoHidden.value = values.complemento || "";
          }
          if (bairroHidden) {
            bairroHidden.value = values.bairro || "";
          }
          if (cidadeHidden) {
            cidadeHidden.value = values.cidade || "";
          }
          if (ufHidden) {
            ufHidden.value = values.uf || "";
          }
        }

        function computeValidationState(values) {
          var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          var state = {
            emailValid: emailPattern.test(values.email),
            emailConfirmValid: emailPattern.test(values.emailConfirm),
            emailsMatch: !!values.email && values.email === values.emailConfirm,
            telefoneValid: /^\d{11}$/.test(values.telefone),
            cepValid: /^\d{8}$/.test(values.cep),
            logradouroValid: !!values.logradouro,
            numeroValid: !!values.numero,
            complementoValid: !!values.complemento,
            bairroValid: !!values.bairro,
            cidadeValid: !!values.cidade,
            ufValid: /^[A-Z]{2}$/.test(values.uf),
          };

          state.allFieldsFilled =
            !!values.email &&
            !!values.emailConfirm &&
            !!values.telefone &&
            !!values.cep &&
            !!values.logradouro &&
            !!values.numero &&
            !!values.complemento &&
            !!values.bairro &&
            !!values.cidade &&
            !!values.uf;

          state.isValid =
            state.emailValid &&
            state.emailConfirmValid &&
            state.emailsMatch &&
            state.telefoneValid &&
            state.cepValid &&
            state.logradouroValid &&
            state.numeroValid &&
            state.complementoValid &&
            state.bairroValid &&
            state.cidadeValid &&
            state.ufValid;

          return state;
        }

        function updateValidationFeedback(state, forceHighlight) {
          if (!state) {
            return;
          }

          if (emailInput) {
            emailInput.classList.toggle("is-invalid", !state.emailValid || !state.emailsMatch);
          }
          if (emailConfirmInput) {
            emailConfirmInput.classList.toggle("is-invalid", !state.emailConfirmValid || !state.emailsMatch);
          }

          var validityMap = [
            [telefoneInput, state.telefoneValid, false],
            [cepInput, state.cepValid, false],
            [logradouroInput, state.logradouroValid, false],
            [numeroInput, state.numeroValid, false],
            [complementoInput, state.complementoValid, false],
            [bairroInput, state.bairroValid, false],
            [cidadeInput, state.cidadeValid, false],
            [ufInput, state.ufValid, true],
          ];

          var shouldHighlight = forceHighlight || state.allFieldsFilled;

          validityMap.forEach(function (entry) {
            var field = entry[0];
            var valid = entry[1];
            var alwaysHighlight = entry[2];
            if (field) {
              var highlight = shouldHighlight || alwaysHighlight;
              field.classList.toggle("is-invalid", highlight && !valid);
            }
          });
        }

        function updateSubmitButton(state) {
          if (updateButton) {
            updateButton.disabled = !state || !state.isValid;
          }
        }

        function validateUpdateData(values) {
          var state = computeValidationState(values);
          var messages = [];

          if (!state.emailValid) {
            messages.push("Informe um e-mail v√°lido.");
          }
          if (!state.emailConfirmValid) {
            messages.push("Confirme o e-mail com um endere√ßo v√°lido.");
          }
          if (state.emailValid && state.emailConfirmValid && !state.emailsMatch) {
            messages.push("Os campos de e-mail devem ser id√™nticos.");
          }
          if (!state.telefoneValid) {
            messages.push("O telefone deve conter exatamente 11 d√≠gitos num√©ricos.");
          }
          if (!state.cepValid) {
            messages.push("Informe um CEP com 8 d√≠gitos.");
          }
          if (!state.logradouroValid) {
            messages.push("Preencha o logradouro.");
          }
          if (!state.numeroValid) {
            messages.push("Informe o n√∫mero do endere√ßo.");
          }
          if (!state.complementoValid) {
            messages.push("Informe o complemento do endere√ßo.");
          }
          if (!state.bairroValid) {
            messages.push("Preencha o bairro.");
          }
          if (!state.cidadeValid) {
            messages.push("Informe a cidade.");
          }
          if (!state.ufValid) {
            messages.push("Informe a UF com duas letras.");
          }

          messages.state = state;
          return messages;
        }

        function collectResourceValues() {
          var numero = "";
          if (recursoNumeroInput) {
            numero = normalizeInscricao(recursoNumeroInput.value);
            if (recursoNumeroInput.value !== numero) {
              recursoNumeroInput.value = numero;
            }
          }

          var numeroValido = recursoPattern.test(numero);
          var arquivosSelecionados = recursoArquivoInputs
            .map(function (entry) {
              if (!entry.input || !entry.input.files || !entry.input.files[0]) {
                return null;
              }
              return {
                input: entry.input,
                tipo: entry.tipo,
                file: entry.input.files[0],
              };
            })
            .filter(function (item) {
              return item !== null;
            });

          return {
            numero: numero,
            numeroValido: numeroValido,
            arquivos: arquivosSelecionados,
            pronto: numeroValido && arquivosSelecionados.length > 0,
          };
        }

        function atualizarFeedbackRecurso(forceHighlight) {
          var state = collectResourceValues();
          var highlightNumero = forceHighlight || (recursoNumeroInput && recursoNumeroInput.dataset.touched === "true");
          var algumArquivoSelecionado = state.arquivos.length > 0;

          if (recursoNumeroInput) {
            recursoNumeroInput.classList.toggle("is-invalid", highlightNumero && !state.numeroValido);
          }

          recursoArquivoInputs.forEach(function (entry) {
            if (!entry.input) {
              return;
            }
            var input = entry.input;
            var touched = forceHighlight || input.dataset.touched === "true";
            var possuiArquivo = input.files && input.files[0];
            input.classList.toggle("is-invalid", touched && !possuiArquivo && !algumArquivoSelecionado);
          });

          if (recursoButton) {
            recursoButton.disabled = !state.pronto;
          }

          return state;
        }

        function lerArquivoComoBase64(file) {
          return new Promise(function (resolve, reject) {
            if (!file) {
              reject(new Error("Arquivo inv√°lido"));
              return;
            }

            var reader = new FileReader();
            reader.onload = function (event) {
              var result = event && event.target ? event.target.result : reader.result;
              if (typeof result !== "string") {
                reject(new Error("N√£o foi poss√≠vel processar o arquivo"));
                return;
              }

              var base64 = result.split(",").pop() || "";
              resolve(base64);
            };
            reader.onerror = function () {
              reject(new Error("Erro ao ler o arquivo"));
            };
            reader.readAsDataURL(file);
          });
        }

        function handleCepLookup() {
          if (!cepInput) {
            return;
          }

          var cepValue = sanitizeDigits(cepInput.value);
          if (cepValue.length !== 8) {
            lastCepConsulted = "";
            return;
          }

          if (cepValue === lastCepConsulted) {
            return;
          }

          lastCepConsulted = cepValue;

          fetch("https://brasilapi.com.br/api/cep/v1/" + cepValue)
            .then(function (response) {
              if (!response.ok) {
                throw new Error("CEP n√£o encontrado");
              }
              return response.json();
            })
            .then(function (data) {
              if (data) {
                if (logradouroInput && data.street) {
                  logradouroInput.value = String(data.street).toUpperCase();
                }
                if (bairroInput && data.neighborhood) {
                  bairroInput.value = String(data.neighborhood).toUpperCase();
                }
                if (cidadeInput && data.city) {
                  cidadeInput.value = String(data.city).toUpperCase();
                }
                if (ufInput && data.state) {
                  ufInput.value = String(data.state).toUpperCase();
                }
              }
              handleInputChange();
            })
            .catch(function (error) {
              lastCepConsulted = "";
              console.error("Erro ao consultar CEP:", error);
              showPopup("N√£o encontramos informa√ß√µes para o CEP informado. Voc√™ pode preencher os campos manualmente.", { tone: "warning" });
            });
        }

        function handleInputChange() {
          var values = collectUpdateValues();
          syncHiddenValues(values);
          var state = computeValidationState(values);
          updateValidationFeedback(state, false);
          updateSubmitButton(state);
        }

        if (telefoneInput) {
          telefoneInput.addEventListener("input", function () {
            var sanitized = sanitizeDigits(telefoneInput.value).slice(0, 11);
            if (telefoneInput.value !== sanitized) {
              telefoneInput.value = sanitized;
            }
            handleInputChange();
          });
          telefoneInput.value = sanitizeDigits(telefoneInput.value).slice(0, 11);
        }

        if (cepInput) {
          cepInput.addEventListener("input", function () {
            var sanitized = sanitizeDigits(cepInput.value).slice(0, 8);
            if (cepInput.value !== sanitized) {
              cepInput.value = sanitized;
            }
            handleInputChange();
          });
          cepInput.addEventListener("keyup", handleCepLookup);
          cepInput.addEventListener("change", handleCepLookup);
          cepInput.addEventListener("blur", handleCepLookup);
          cepInput.value = sanitizeDigits(cepInput.value).slice(0, 8);
        }

        if (cepInput && ufInput) {
          (function attemptInitialCepLookup(attempt) {
            if (!cepInput || !ufInput) {
              return;
            }

            var cepValue = sanitizeDigits(cepInput.value);
            var ufValue = String(ufInput.value || "").trim().toUpperCase();
            var shouldLookup = cepValue.length === 8 && (!ufValue || ufValue === "UN");

            if (shouldLookup) {
              lastCepConsulted = "";
              handleCepLookup();
              return;
            }

            var needsRetry = (!ufValue || ufValue === "UN") && attempt < 5;
            if (needsRetry) {
              window.setTimeout(function () {
                attemptInitialCepLookup(attempt + 1);
              }, 200);
            }
          })(0);
        }

        if (ufInput) {
          ufInput.addEventListener("input", function () {
            var sanitized = String(ufInput.value || "").replace(/[^a-zA-Z]/g, "").slice(0, 2).toUpperCase();
            if (ufInput.value !== sanitized) {
              ufInput.value = sanitized;
            }
            handleInputChange();
          });
          ufInput.value = String(ufInput.value || "").replace(/[^a-zA-Z]/g, "").slice(0, 2).toUpperCase();
        }

        if (recursoNumeroInput) {
          recursoNumeroInput.addEventListener("input", function () {
            var normalized = normalizeInscricao(recursoNumeroInput.value);
            if (recursoNumeroInput.value !== normalized) {
              recursoNumeroInput.value = normalized;
            }
            atualizarFeedbackRecurso(false);
          });
          recursoNumeroInput.addEventListener("focus", function () {
            if (!recursoNumeroInput.value) {
              recursoNumeroInput.value = recursoPrefix;
            }
          });
          recursoNumeroInput.addEventListener("blur", function () {
            recursoNumeroInput.dataset.touched = "true";
            atualizarFeedbackRecurso(false);
          });
        }

        recursoArquivoInputs.forEach(function (entry) {
          if (!entry.input) {
            return;
          }
          entry.input.addEventListener("change", function () {
            entry.input.dataset.touched = "true";
            atualizarFeedbackRecurso(false);
          });
          entry.input.addEventListener("blur", function () {
            entry.input.dataset.touched = "true";
            atualizarFeedbackRecurso(false);
          });
        });

        [emailInput, emailConfirmInput, telefoneInput, cepInput, logradouroInput, numeroInput, complementoInput, bairroInput, cidadeInput, ufInput]
          .filter(function (input) {
            return !!input;
          })
          .forEach(function (input) {
            input.addEventListener("input", handleInputChange);
            input.addEventListener("blur", handleInputChange);
          });

        handleInputChange();
        atualizarFeedbackRecurso(false);
        carregarMinhasInscricoes();

        function parseDate(raw) {
          if (!raw || typeof raw !== "string") {
            return null;
          }

          var normalized = raw.trim();
          var directDate = new Date(normalized);
          if (!isNaN(directDate.getTime())) {
            return directDate;
          }

          var brPattern = /^([0-3]?\d)\/([0-1]?\d)\/(\d{4})$/;
          var match = normalized.match(brPattern);
          if (match) {
            var day = parseInt(match[1], 10);
            var month = parseInt(match[2], 10) - 1;
            var year = parseInt(match[3], 10);
            var parsed = new Date(year, month, day);
            return isNaN(parsed.getTime()) ? null : parsed;
          }

          return null;
        }

        function formatDate(dateObj) {
          if (!(dateObj instanceof Date) || isNaN(dateObj.getTime())) {
            return "";
          }
          return dateObj.toLocaleDateString("pt-BR", { day: "2-digit", month: "2-digit", year: "numeric" });
        }

        fetch("https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/7b3f9046-f11b-4cc3-b570-c3e586748f6c")
          .then(function (response) {
            if (!response.ok) {
              throw new Error("Falha ao carregar publica√ß√µes");
            }
            return response.json();
          })
          .then(function (data) {
            var list = document.getElementById("publicacoes-list");
            if (!list) {
              return;
            }

            list.innerHTML = "";

            var entries = [];

            if (Array.isArray(data)) {
              entries = data;
            } else if (data && Array.isArray(data.items)) {
              entries = data.items;
            }

            if (!Array.isArray(entries) || entries.length === 0) {
              list.innerHTML = '<li class="text-muted">Nenhuma publica√ß√£o dispon√≠vel no momento.</li>';
              return;
            }

            var processedEntries = entries
              .map(function (item) {
                if (!item || !item.url) {
                  return null;
                }

                var description = item.description || item.descricao || item.title || item.titulo;
                if (!description) {
                  return null;
                }

                description = String(description).trim();
                if (!description) {
                  return null;
                }

                var rawDate = item.date || item.data || item.dt || item.createdAt;
                var dateObj = parseDate(rawDate);

                var extension =
                  item.extension ||
                  item.extensao ||
                  item.fileExtension ||
                  item.tipoArquivo ||
                  "";

                return {
                  url: item.url,
                  description: description,
                  dateObj: dateObj,
                  rawDate: rawDate,
                  mimetype:
                    item.mimetype ||
                    item.mimeType ||
                    item.contentType ||
                    item.tipoMime ||
                    "",
                  extension: extension,
                };
              })
              .filter(function (entry) {
                return entry !== null;
              });

            if (!processedEntries.length) {
              list.innerHTML = '<li class="text-muted">Nenhuma publica√ß√£o dispon√≠vel no momento.</li>';
              return;
            }

            processedEntries
              .sort(function (a, b) {
                var timeA = a.dateObj ? a.dateObj.getTime() : 0;
                var timeB = b.dateObj ? b.dateObj.getTime() : 0;
                return timeB - timeA;
              })
              .forEach(function (entry) {
                var icon = getPublicationIcon(entry.mimetype, entry.extension, entry.url);
                var formattedDate = formatDate(entry.dateObj);
                var listItem = document.createElement("li");
                listItem.className = "publicacoes-item";

                var normalizedUrl = entry.url;
                try {
                  normalizedUrl = new URL(entry.url, window.location.href).href;
                } catch (error) {
                  normalizedUrl = entry.url;
                }

                var linkEl = document.createElement("a");
                linkEl.className = "publicacoes-item-link link-primary";
                linkEl.href = normalizedUrl;
                linkEl.title = entry.description;

                var downloadName = "";
                try {
                  var urlObject = new URL(normalizedUrl, window.location.href);
                  downloadName = urlObject.pathname.split("/").pop() || "";
                  if (downloadName) {
                    downloadName = decodeURIComponent(downloadName);
                  }
                } catch (error) {
                  var fallbackPath = normalizedUrl.split("?")[0].split("#")[0];
                  downloadName = fallbackPath.split("/").pop() || "";
                }

                if (downloadName) {
                  linkEl.setAttribute("download", downloadName);
                } else {
                  linkEl.setAttribute("download", "");
                }

                var iconSpan = document.createElement("span");
                var iconType = icon || "generic";
                iconSpan.className = "publicacoes-item-icon publicacoes-item-icon--" + iconType;
                iconSpan.setAttribute("aria-hidden", "true");

                var textSpan = document.createElement("span");
                textSpan.textContent = entry.description;

                linkEl.appendChild(iconSpan);
                linkEl.appendChild(textSpan);

                listItem.appendChild(linkEl);

                if (formattedDate) {
                  var timeEl = document.createElement("time");
                  timeEl.textContent = formattedDate;
                  timeEl.dateTime = entry.dateObj ? entry.dateObj.toISOString() : entry.rawDate || "";
                  listItem.appendChild(timeEl);
                }

                list.appendChild(listItem);
              });
          })
          .catch(function (error) {
            console.error(error);
            var list = document.getElementById("publicacoes-list");
            if (list) {
              list.innerHTML = '<li class="text-muted">N√£o foi poss√≠vel carregar as publica√ß√µes.</li>';
            }
          });

        if (button) {
          button.addEventListener("click", function () {
            var authorization = authorizationField ? authorizationField.value : "";

            fetch(targetUrl, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ authorization: authorization }),
            })
              .catch(function (error) {
                console.error("Falha ao enviar autoriza√ß√£o:", error);
              })
              .finally(function () {
                window.location.href = redirectUrl;
              });
          });
        }

        if (updateButton) {
          updateButton.addEventListener("click", function () {
            var values = collectUpdateValues();
            syncHiddenValues(values);

            var validationErrors = validateUpdateData(values);
            var state = validationErrors.state || computeValidationState(values);
            updateValidationFeedback(state, true);
            updateSubmitButton(state);

            if (validationErrors.length) {
              showPopup(validationErrors.join("\n"), { tone: "warning", data: { status: "warning" } });
              return;
            }

            var payload = {
              cpf: values.cpf,
              email: values.email,
              emailConfirm: values.emailConfirm,
              telefone: values.telefone,
              cep: values.cep,
              logradouro: values.logradouro,
              numero: values.numero,
              complemento: values.complemento,
              bairro: values.bairro,
              cidade: values.cidade,
              uf: values.uf,
            };

            fetch("https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/204c8f95-ccdd-41e6-8ccf-40b7795a01fb", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(payload),
            })
              .then(function (response) {
                return response
                  .clone()
                  .json()
                  .catch(function () {
                    return response.text();
                  })
                  .then(function (parsed) {
                    return { parsed: parsed, ok: response.ok, status: response.status };
                  });
              })
              .then(function (result) {
                var data = result.parsed;
                var isSuccess = !!result.ok;
                var message;
                var tone;

                if (typeof data === "string") {
                  message = data;
                  tone = determineToneFromContent(message, null);
                } else {
                  var payloadMessage = data && (data.message || data.detail || data.statusText || data.title);
                  message = payloadMessage || JSON.stringify(data);
                  tone = determineToneFromContent(message, data);

                  if (data && typeof data.success === "boolean") {
                    isSuccess = data.success;
                  } else if (data && typeof data.status === "string") {
                    var normalizedStatus = data.status.toLowerCase();
                    if (normalizedStatus === "success" || normalizedStatus === "sucesso" || normalizedStatus === "ok") {
                      isSuccess = true;
                    }
                    if (normalizedStatus === "erro" || normalizedStatus === "error" || normalizedStatus === "falha") {
                      isSuccess = false;
                    }
                  }
                }

                if (tone === "error" || tone === "warning") {
                  isSuccess = false;
                }

                if (!tone && isSuccess) {
                  tone = "success";
                }

                showPopup(message, {
                  data: typeof data === "string" ? null : data,
                  tone: tone,
                  onClose: isSuccess ? cleanupUpdateForm : null,
                });
              })
              .catch(function (error) {
                console.error("Falha ao enviar atualiza√ß√£o cadastral:", error);
                showPopup("N√£o foi poss√≠vel enviar a atualiza√ß√£o cadastral. Tente novamente em instantes.", { tone: "error" });
              });
          });
        }

        if (recursoButton) {
          recursoButton.addEventListener("click", function () {
            if (recursoNumeroInput) {
              recursoNumeroInput.dataset.touched = "true";
            }
            recursoArquivoInputs.forEach(function (entry) {
              if (entry.input) {
                entry.input.dataset.touched = "true";
              }
            });
            var state = atualizarFeedbackRecurso(true);
            if (!state.pronto) {
              var erros = [];
              if (!state.numeroValido) {
                erros.push("Informe o n√∫mero da inscri√ß√£o no formato SSHVR2025XXXXXX.");
              }
              if (state.arquivos.length === 0) {
                erros.push("Selecione ao menos um arquivo de recurso para prosseguir.");
              }
              showPopup(erros.join(" "), { tone: "warning", data: { status: "warning" } });
              return;
            }

            if (!recursoEndpoint) {
              showPopup("N√£o foi poss√≠vel enviar o recurso porque o endpoint n√£o est√° configurado.", { tone: "error" });
              return;
            }

            var arquivoExcedido = state.arquivos.find(function (item) {
              return item.file && item.file.size > recursoMaxFileSize;
            });
            if (arquivoExcedido) {
              var legendaArquivo = arquivoExcedido.input ? arquivoExcedido.input.getAttribute("data-legenda") : "arquivo do recurso";
              if (arquivoExcedido.input) {
                arquivoExcedido.input.classList.add("is-invalid");
              }
              showPopup("O anexo \"" + legendaArquivo + "\" deve ter no m√°ximo 10 MB.", { tone: "warning", data: { status: "warning" } });
              return;
            }

            recursoButton.setAttribute("data-original-text", recursoButton.textContent || "Enviar recurso");
            recursoButton.textContent = "Enviando...";
            recursoButton.disabled = true;

            var cpfField = document.getElementById("cpf");

            Promise.all(
              state.arquivos.map(function (item) {
                return lerArquivoComoBase64(item.file).then(function (base64) {
                  var input = item.input;
                  var legenda = input ? input.getAttribute("data-legenda") : "";
                  return {
                    tipo: item.tipo,
                    legenda: legenda || item.tipo,
                    nomeOriginal: item.file.name,
                    nomeComInscricao: state.numero + "_" + item.file.name,
                    mime: item.file.type,
                    tamanho: item.file.size,
                    conteudoBase64: base64,
                  };
                });
              })
            )
                .then(function (arquivosConvertidos) {
                  var payload = {
                    numeroInscricao: state.numero,
                    cpf: cpfField ? cpfField.value : "",
                    anexos: arquivosConvertidos,
                    arquivos: arquivosConvertidos,
                    acao: "recurso",
                  };

                return fetch(recursoEndpoint, {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify(payload),
                });
              })
              .then(function (response) {
                return response
                  .clone()
                  .json()
                  .catch(function () {
                    return response.text();
                  })
                  .then(function (parsed) {
                    return { parsed: parsed, ok: response.ok, status: response.status };
                  });
              })
              .then(function (result) {
                var data = result.parsed;
                var isSuccess = !!result.ok;
                var message;
                var tone;

                if (typeof data === "string") {
                  message = data;
                  tone = determineToneFromContent(message, null);
                } else {
                  var payloadMessage = data && (data.message || data.detail || data.statusText || data.title);
                  message = payloadMessage || JSON.stringify(data);
                  tone = determineToneFromContent(message, data);

                  if (data && typeof data.success === "boolean") {
                    isSuccess = data.success;
                  } else if (data && typeof data.status === "string") {
                    var normalizedStatus = data.status.toLowerCase();
                    if (normalizedStatus === "success" || normalizedStatus === "sucesso" || normalizedStatus === "ok") {
                      isSuccess = true;
                    }
                    if (normalizedStatus === "erro" || normalizedStatus === "error" || normalizedStatus === "falha") {
                      isSuccess = false;
                    }
                  }
                }

                if (tone === "error" || tone === "warning") {
                  isSuccess = false;
                }

                if (!tone && isSuccess) {
                  tone = "success";
                }

                showPopup(message, {
                  data: typeof data === "string" ? null : data,
                  tone: tone,
                  onClose: isSuccess ? cleanupRecursoForm : null,
                });
              })
              .catch(function (error) {
                console.error("Falha ao enviar recurso:", error);
                showPopup("N√£o foi poss√≠vel enviar o recurso. Tente novamente em instantes.", { tone: "error" });
              })
              .finally(function () {
                var originalLabel = recursoButton.getAttribute("data-original-text") || "Enviar recurso";
                recursoButton.textContent = originalLabel;
                recursoButton.disabled = false;
                atualizarFeedbackRecurso(false);
              });
          });
        }
      });
    </script>
  </body>
</html>
